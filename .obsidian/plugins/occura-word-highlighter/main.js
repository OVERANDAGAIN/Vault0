/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var T=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var U=(r,i)=>{for(var t in i)T(r,t,{get:i[t],enumerable:!0})},F=(r,i,t,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of I(i))!G.call(r,o)&&o!==t&&T(r,o,{get:()=>i[o],enumerable:!(s=M(i,o))||s.enumerable});return r};var W=r=>F(T({},"__esModule",{value:!0}),r);var _={};U(_,{default:()=>x});module.exports=W(_);var y=require("obsidian"),$=require("@codemirror/state");var p=require("obsidian"),O={highlightColorOccurrences:"#FFFF00",highlightColorKeywords:"#bdfc64",occuraPluginEnabled:!0,occuraPluginEnabledHotKey:"",statusBarOccurrencesNumberEnabled:!0,keywords:[],autoKeywordsHighlightEnabled:!1,keywordsCaseSensitive:!1,occuraCaseSensitive:!1,keywordGroups:[]},C=class extends p.PluginSettingTab{constructor(t,s){super(t,s);this.keywordComponents=[];this.keywordSectionOpen=!1;this.groupOpen={};this.plugin=s}display(){let{containerEl:t}=this;t.empty();let s=t.createEl("details");s.open=!0,s.createEl("summary",{text:"General"}),new p.Setting(s).setName("Highlight color (occurrences)").setDesc("Set the color used to highlight all occurrences.").addText(e=>{e.inputEl.type="color",e.setValue(this.plugin.settings.highlightColorOccurrences).onChange(async n=>{this.plugin.settings.highlightColorOccurrences=n,await this.plugin.saveSettings(),this.plugin.updateHighlightStyle()})}),new p.Setting(s).setName("Case sensitive (occurrences)").setDesc("Match only exact-case when finding all selected-text occurrences.").addToggle(e=>e.setValue(this.plugin.settings.occuraCaseSensitive).onChange(async n=>{this.plugin.settings.occuraCaseSensitive=n,await this.plugin.saveSettings(),this.plugin.updateEditors()})),new p.Setting(s).setName("Hotkey").setDesc("Click and press the desired hotkey combination.").addText(e=>{e.setPlaceholder("Click and press hotkey").setValue(this.plugin.settings.occuraPluginEnabledHotKey),e.inputEl.addEventListener("focus",()=>e.inputEl.value=""),e.inputEl.addEventListener("blur",()=>{e.inputEl.value||e.setValue(this.plugin.settings.occuraPluginEnabledHotKey)}),e.inputEl.addEventListener("keydown",async n=>{n.preventDefault(),n.stopPropagation();let a=this.captureHotkey(n);e.setValue(a),this.plugin.settings.occuraPluginEnabledHotKey=a,await this.plugin.saveSettings(),this.plugin.updateKeyHandler()})}),new p.Setting(s).setName("Display the number of occurrences").setDesc("Show the total count of occurrences in the status bar.").addToggle(e=>{e.setValue(this.plugin.settings.statusBarOccurrencesNumberEnabled).onChange(async n=>{this.plugin.settings.statusBarOccurrencesNumberEnabled=n,await this.plugin.saveSettings(),this.plugin.updateEditors()})});let o=t.createEl("details");o.open=this.keywordSectionOpen,o.createEl("summary",{text:"Keyword Highlighting"}),o.addEventListener("toggle",()=>{this.keywordSectionOpen=o.open}),new p.Setting(o).setName("Automatic keywords highlighting").setDesc("Highlight keywords automatically as you type.").addToggle(e=>{e.setValue(this.plugin.settings.autoKeywordsHighlightEnabled).onChange(async n=>{this.plugin.settings.autoKeywordsHighlightEnabled=n,await this.plugin.saveSettings(),this.plugin.updateEditors()})}),new p.Setting(o).setName("Word classes").setDesc("Each class has a color and its own word list.").addButton(e=>{e.setButtonText("Add Class").setCta().onClick(async()=>{var a,l;let n={id:(l=(a=crypto==null?void 0:crypto.randomUUID)==null?void 0:a.call(crypto))!=null?l:String(Date.now()),name:"New class",color:"#66ccff",keywords:[],enabled:!0,caseSensitive:!1};this.plugin.settings.keywordGroups.push(n),await this.plugin.saveSettings(),this.display()}),["mousedown","click"].forEach(n=>e.buttonEl.addEventListener(n,a=>a.stopPropagation()))}),this.plugin.settings.keywordGroups.forEach((e,n)=>{var E;let a=o.createEl("details");a.open=(E=this.groupOpen[e.id])!=null?E:!1,a.addEventListener("toggle",()=>{this.groupOpen[e.id]=a.open});let l=a.createEl("summary"),u=l.createEl("span",{cls:"occura-color-swatch"});u.setAttr("style",`display:inline-block;width:12px;height:12px;border-radius:3px;background:${e.color};margin-right:8px;`),l.createSpan({text:e.name}),new p.Setting(a).setName("Class name").addText(c=>{c.setValue(e.name).onChange(async h=>{e.name=h||"Unnamed",await this.plugin.saveSettings(),l.empty(),l.createEl("span",{cls:"occura-color-swatch"}).setAttr("style",`display:inline-block;width:12px;height:12px;border-radius:3px;background:${e.color};margin-right:8px;`),l.createSpan({text:e.name})})}).addExtraButton(c=>{c.setIcon("trash").onClick(async()=>{confirm(`Delete class "${e.name}"?`)&&(this.plugin.settings.keywordGroups.splice(n,1),delete this.groupOpen[e.id],await this.plugin.saveSettings(),this.display())})}),new p.Setting(a).setName("Enabled").setDesc("Turn this class on or off.").addToggle(c=>{c.setValue(e.enabled).onChange(async h=>{e.enabled=h,await this.plugin.saveSettings(),this.plugin.updateEditors()})}),new p.Setting(a).setName("Color").setDesc("Set the color used to highlight all words occurrences.").addText(c=>{c.inputEl.type="color",c.setValue(e.color).onChange(async h=>{e.color=h||"#66ccff",await this.plugin.saveSettings(),u.setAttr("style",`display:inline-block;width:12px;height:12px;border-radius:3px;background:${e.color};margin-right:8px;`),this.plugin.updateHighlightStyle()})}),new p.Setting(a).setName("Case sensitive").setDesc("Match words with exact case.").addToggle(c=>{c.setValue(e.caseSensitive).onChange(async h=>{e.caseSensitive=h,await this.plugin.saveSettings(),this.plugin.updateEditors()})});let d=document.createElement("input");d.type="file",d.accept=".txt",d.style.display="none",d.addEventListener("change",async c=>{var S;c.stopPropagation();let h=(S=c.target.files)==null?void 0:S[0];if(!h)return;let b=(await h.text()).split(/[\n,]/).map(f=>f.trim()).filter(f=>f&&!(f.startsWith('"')&&f.endsWith('"')));e.keywords=b,await this.plugin.saveSettings(),this.groupOpen[e.id]=!0,this.display()}),a.appendChild(d),new p.Setting(a).addButton(c=>{c.setButtonText("Import Words").onClick(()=>d.click()),["mousedown","click"].forEach(h=>c.buttonEl.addEventListener(h,m=>m.stopPropagation()))}).addButton(c=>{c.setButtonText("Export Words").onClick(()=>{let h=new Blob([e.keywords.join(",")],{type:"text/plain"}),m=URL.createObjectURL(h),b=document.createElement("a");b.href=m,b.download=`${e.name.replace(/\s+/g,"_")}.txt`,b.click(),URL.revokeObjectURL(m)}),["mousedown","click"].forEach(h=>c.buttonEl.addEventListener(h,m=>m.stopPropagation()))}).addButton(c=>{c.setButtonText("Add Word").setCta().onClick(()=>{e.keywords.push(""),this.groupOpen[e.id]=!0,this.display()}),["mousedown","click"].forEach(h=>c.buttonEl.addEventListener(h,m=>m.stopPropagation()))});let w=a.createEl("div",{cls:"occura-keywords-container"});e.keywords.forEach((c,h)=>{let m=w.createEl("div",{cls:"occura-keyword-item"});new p.TextComponent(m).setPlaceholder("Enter word").setValue(c).onChange(async f=>{e.keywords[h]=f,await this.plugin.saveSettings()}).inputEl.addClass("occura-keyword-input");let S=m.createEl("button",{text:"\u2715",cls:"occura-remove-button"});["mousedown","click"].forEach(f=>S.addEventListener(f,R=>R.stopPropagation())),S.addEventListener("click",async()=>{e.keywords.splice(h,1),await this.plugin.saveSettings(),this.groupOpen[e.id]=!0,this.display()})})}),new p.Setting(t).setName("Reset to defaults").addButton(e=>{e.setButtonText("Reset").setWarning().onClick(async()=>{Object.assign(this.plugin.settings,O),await this.plugin.saveSettings(),this.display()})})}captureHotkey(t){let s=[];(t.ctrlKey||t.metaKey)&&s.push("Mod"),t.shiftKey&&s.push("Shift"),t.altKey&&s.push("Alt");let o=t.key.toUpperCase();return["CONTROL","SHIFT","ALT","META"].includes(o)||s.push(o),s.join("+")}};var v=require("@codemirror/view"),P=require("@codemirror/state"),g=require("obsidian"),j=v.Decoration.mark({class:"found-occurrence",priority:100}),se=v.Decoration.mark({class:"keyword-occurrence",priority:50});function q(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function k(r,i,t=!0){let s=i?"g":"gi",o=q(r),e=t&&/^\w+$/.test(r);return new RegExp(e?`\\b${o}\\b`:o,s)}var K=0;function H(r){return v.ViewPlugin.fromClass(class{constructor(i){this.view=i;this.lastEnabled=r.settings.occuraPluginEnabled;this.lastAutoHL=r.settings.autoKeywordsHighlightEnabled;this.groupDecoCache=new Map;this.decorations=this.buildDecorations()}update(i){(i.selectionSet||i.docChanged||i.viewportChanged||r.settings.occuraPluginEnabled!==this.lastEnabled||r.settings.autoKeywordsHighlightEnabled!==this.lastAutoHL)&&(this.decorations=this.buildDecorations())}getGroupDecoration(i){let t=this.groupDecoCache.get(i);return t||(t=v.Decoration.mark({class:`occura-kw-${i}`,priority:50}),this.groupDecoCache.set(i,t)),t}buildDecorations(){var o;this.lastEnabled=r.settings.occuraPluginEnabled,this.lastAutoHL=r.settings.autoKeywordsHighlightEnabled;let i=[],t=new Set;if(K=0,r.settings.occuraPluginEnabled){let{state:e}=this.view,n=e.selection.main;if(n.empty)this.updateStatusBar("");else{let a=e.doc.sliceString(n.from,n.to).trim();if(a&&!/\s/.test(a)){let l=k(a,r.settings.occuraCaseSensitive,!1);this.collectVisibleMatches(l,j,i,t),this.updateStatusBar(a)}else this.updateStatusBar("")}}if(r.settings.occuraPluginEnabled&&r.settings.autoKeywordsHighlightEnabled&&Array.isArray(r.settings.keywordGroups))for(let e of r.settings.keywordGroups){if(!(e!=null&&e.enabled))continue;let n=((o=e.keywords)!=null?o:[]).map(l=>l.trim()).filter(Boolean);if(n.length===0)continue;let a=this.getGroupDecoration(e.id);for(let l of n){let u=k(l,!!e.caseSensitive,!0);this.collectVisibleMatches(u,a,i,t)}}i.sort((e,n)=>e.from-n.from||e.startSide-n.startSide||e.to-n.to);let s=new P.RangeSetBuilder;for(let e of i)s.add(e.from,e.to,e.deco);return s.finish()}collectVisibleMatches(i,t,s,o){var a,l;let e=(l=(a=t==null?void 0:t.spec)==null?void 0:a.startSide)!=null?l:0,{state:n}=this.view;for(let{from:u,to:d}of this.view.visibleRanges){let w=n.doc.sliceString(u,d);i.lastIndex=0;let E;for(;E=i.exec(w);){let c=u+E.index,h=c+E[0].length,m=`${c}:${h}`;o.has(m)||(o.add(m),s.push({from:c,to:h,deco:t,startSide:e}),K++)}}}updateStatusBar(i){r.statusBarOccurrencesNumber&&r.settings.statusBarOccurrencesNumberEnabled&&r.statusBarOccurrencesNumber.setText(i?`Occura found: ${i} ${K} times`:"")}},{decorations:i=>i.decorations})}function D(r){let i=r.app.workspace.getActiveViewOfType(g.MarkdownView);if(!i)return new g.Notice("No active editor");let t=i.editor,s=t.getSelection().trim();if(!s||/\s/.test(s))return new g.Notice("Select some text first.");let o=k(s,!0,!1),e=t.getValue(),n=[],a;for(;a=o.exec(e);)n.push({from:a.index,to:a.index+a[0].length});if(!n.length)return new g.Notice("No occurrences found.");let l=t.cm,u=n.reverse().map(d=>({from:d.from,to:d.to,insert:`==${e.slice(d.from,d.to)}==`}));l.dispatch({changes:u}),new g.Notice(`Permanently highlighted ${n.length} occurrences.`)}function L(r){let i=r.app.workspace.getActiveViewOfType(g.MarkdownView);if(!i)return new g.Notice("No active editor");let t=i.editor,s=t.getSelection().trim();if(!s||/\s/.test(s))return new g.Notice("Select text to un-highlight.");let o=k(`==${s}==`,!0,!1),e=t.getValue(),n=[],a;for(;a=o.exec(e);)n.push({from:a.index,to:a.index+a[0].length});if(!n.length)return new g.Notice("No highlighted occurrences found.");let l=t.cm,u=n.reverse().map(d=>({from:d.from,to:d.to,insert:e.slice(d.from+2,d.to-2)}));l.dispatch({changes:u}),new g.Notice(`Removed highlighting from ${n.length} occurrences.`)}function V(r){let i=r.app.workspace.getActiveViewOfType(g.MarkdownView);if(!i)return new g.Notice("No active editor");let t=i.editor,s=t.getSelection().trim();if(!s||/\s/.test(s))return new g.Notice("Select one word to tag.");let o=k(s,!0,!0),e=t.getValue(),n=[],a;for(;a=o.exec(e);)n.push({from:a.index,to:a.index+a[0].length});if(!n.length)return new g.Notice("No occurrences found.");n.reverse().forEach(l=>{let u=t.offsetToPos(l.from),d=t.offsetToPos(l.to),w=t.getRange(u,d);t.replaceRange(`#${w}`,u,d)}),new g.Notice(`Tagged ${n.length} occurrences.`)}function B(r){let i=r.app.workspace.getActiveViewOfType(g.MarkdownView);if(!i)return new g.Notice("No active editor");let t=i.editor,s=t.getSelection().trim();if(!s||/\s/.test(s))return new g.Notice("Select the tagged word.");let o=k(`#${s}`,!0,!1),e=t.getValue(),n=[],a;for(;a=o.exec(e);)n.push({from:a.index,to:a.index+a[0].length});if(!n.length)return new g.Notice("No tagged occurrences found.");n.reverse().forEach(l=>{let u=t.offsetToPos(l.from),d=t.offsetToPos(l.to),w=t.getRange(u,d).replace(/^#+/,"");t.replaceRange(w,u,d)}),new g.Notice(`Removed tags from ${n.length} occurrences.`)}var N=require("obsidian");function A(r){var o;let i={ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1},t=r.split("+"),s=((o=t.pop())==null?void 0:o.toUpperCase())||"";for(let e of t)switch(e.toLowerCase()){case"mod":N.Platform.isMacOS?i.metaKey=!0:i.ctrlKey=!0;break;case"ctrl":i.ctrlKey=!0;break;case"cmd":case"meta":i.metaKey=!0;break;case"shift":i.shiftKey=!0;break;case"alt":case"option":i.altKey=!0;break;default:break}return{key:s,modifiers:i}}var x=class extends y.Plugin{async onload(){await this.loadSettings(),this.highlightCompartment=new $.Compartment,this.addSettingTab(new C(this.app,this)),this.registerEditorExtension(this.highlightCompartment.of(H(this))),this.updateHighlightStyle(),this.addCommand({id:"toggle-highlight-occurrences",name:"Toggle highlight occurrences",callback:()=>{this.toggleHighlighting()}}),this.addCommand({id:"toggle-keyword-highlighting",name:"Toggle keyword highlighting",callback:()=>{this.toggleKeywordHighlighting()}}),this.addCommand({id:"set-permanent-highlight-occurrences",name:"Set permanently highlight for occurrences",callback:()=>{this.settings.occuraPluginEnabled?D(this):new y.Notice("Please enable Occura")}}),this.addCommand({id:"remove-permanent-highlight-occurrences",name:"Remove permanently highlight for occurrences",callback:()=>{this.settings.occuraPluginEnabled?L(this):new y.Notice("Please enable Occura")}}),this.addCommand({id:"create-tag-for-occurrences",name:"Create Tag for occurrences",callback:()=>{this.settings.occuraPluginEnabled?V(this):new y.Notice("Please enable Occura")}}),this.addCommand({id:"remove-tag-from-occurrences",name:"Remove Tag for occurrences",callback:()=>{this.settings.occuraPluginEnabled?B(this):new y.Notice("Please enable Occura")}}),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.addIconsToAllLeaves()})),this.addIconsToAllLeaves(),this.updateKeyHandler()}updateKeyHandler(){this.keyHandler&&window.removeEventListener("keydown",this.keyHandler,!0);let t=A(this.settings.occuraPluginEnabledHotKey);this.keyHandler=s=>{let e=s.key.toUpperCase().replace("ARROW","");if(s.ctrlKey===t.modifiers.ctrlKey&&s.shiftKey===t.modifiers.shiftKey&&s.altKey===t.modifiers.altKey&&s.metaKey===t.modifiers.metaKey&&e===t.key)return s.preventDefault(),s.stopPropagation(),this.toggleHighlighting(),!1},window.addEventListener("keydown",this.keyHandler,!0)}async loadSettings(){this.settings=Object.assign({},O,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}toggleHighlighting(){this.settings.occuraPluginEnabled=!this.settings.occuraPluginEnabled,this.saveSettings(),this.updateEditors(),this.updateAllTitleBarIcons()}toggleKeywordHighlighting(){this.settings.autoKeywordsHighlightEnabled=!this.settings.autoKeywordsHighlightEnabled,this.saveSettings(),this.updateEditors()}handleDocumentClick(t){if(!t.target.closest(".cm-content")){let o=this.app.workspace.getActiveViewOfType(y.MarkdownView);o&&o.editor.setCursor(o.editor.getCursor())}}updateHighlightStyle(){this.styleEl&&this.styleEl.remove();let t=Array.isArray(this.settings.keywordGroups)?this.settings.keywordGroups:[],s=[`.found-occurrence { background-color: ${this.settings.highlightColorOccurrences}; }`,...t.map(o=>`.occura-kw-${o.id} { background-color: ${o.color} !important; }`),...t.map(o=>`.keyword-occurrence.occura-kw-${o.id} { background-color: ${o.color} !important; }`)].join(`
`);this.styleEl=document.createElement("style"),this.styleEl.id="occura-style",this.styleEl.textContent=s,document.head.appendChild(this.styleEl)}updateEditors(){let t=this.app.workspace.getLeavesOfType("markdown").map(s=>s.view).filter(s=>s instanceof y.MarkdownView);for(let s of t){let o=s.editor.cm;o&&o.dispatch({effects:this.highlightCompartment.reconfigure(H(this))})}}addIconsToAllLeaves(){let t=this.app.workspace.getLeavesOfType("markdown");for(let s of t)this.addTitleBarIcon(s)}addTitleBarIcon(t){if(!(t.view instanceof y.MarkdownView))return;let s=t.view,o=s.containerEl.querySelector(".highlight-toggle-icon");o&&o.remove();let e=document.createElement("div");e.addClass("highlight-toggle-icon","clickable-icon"),this.updateIconElement(e),e.addEventListener("click",()=>{this.toggleHighlighting()});let n=s.containerEl.querySelector(".view-header");if(n){let a=n.querySelector(".view-actions");a&&a.insertBefore(e,a.firstChild)}}updateAllTitleBarIcons(){document.querySelectorAll(".highlight-toggle-icon").forEach(s=>{this.updateIconElement(s)})}updateIconElement(t){t.empty(),(0,y.setIcon)(t,"highlighter"),this.settings.occuraPluginEnabled?(this.statusBarOccurrencesNumber||(this.statusBarOccurrencesNumber=this.addStatusBarItem()),(0,y.setTooltip)(t,"Disable highlighting"),t.removeClass("is-disabled")):((0,y.setTooltip)(t,"Enable highlighting"),t.addClass("is-disabled"))}onunload(){window.removeEventListener("keydown",this.keyHandler,!0),this.styleEl&&this.styleEl.remove(),document.querySelectorAll(".highlight-toggle-icon").forEach(s=>s.remove())}};

/* nosourcemap */