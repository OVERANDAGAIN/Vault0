/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var b=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var D=(r,o)=>{for(var e in o)b(r,e,{get:o[e],enumerable:!0})},A=(r,o,e,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of V(o))!B.call(r,n)&&n!==e&&b(r,n,{get:()=>o[n],enumerable:!(s=N(o,n))||s.enumerable});return r};var R=r=>A(b({},"__esModule",{value:!0}),r);var M={};D(M,{default:()=>E});module.exports=R(M);var m=require("obsidian"),L=require("@codemirror/state");var p=require("obsidian"),k={highlightColorOccurrences:"#FFFF00",highlightColorKeywords:"#bdfc64",occuraPluginEnabled:!0,occuraPluginEnabledHotKey:"",statusBarOccurrencesNumberEnabled:!0,keywords:[],autoKeywordsHighlightEnabled:!1,keywordsCaseSensitive:!1,occuraCaseSensitive:!1},f=class extends p.PluginSettingTab{constructor(e,s){super(e,s);this.keywordComponents=[];this.keywordSectionOpen=!1;this.plugin=s}display(){let{containerEl:e}=this;e.empty();let s=e.createEl("details");s.open=!0,s.createEl("summary",{text:"General"}),new p.Setting(s).setName("Highlight color (occurrences)").setDesc("Set the color used to highlight all occurrences.").addText(t=>{t.inputEl.type="color",t.setValue(this.plugin.settings.highlightColorOccurrences).onChange(async i=>{this.plugin.settings.highlightColorOccurrences=i,await this.plugin.saveSettings(),this.plugin.updateHighlightStyle()})}),new p.Setting(s).setName("Case sensitive (occurrences)").setDesc("Match only exact-case when finding all selected-text occurrences.").addToggle(t=>t.setValue(this.plugin.settings.occuraCaseSensitive).onChange(async i=>{this.plugin.settings.occuraCaseSensitive=i,await this.plugin.saveSettings(),this.plugin.updateEditors()})),new p.Setting(s).setName("Hotkey").setDesc("Click and press the desired hotkey combination.").addText(t=>{t.setPlaceholder("Click and press hotkey").setValue(this.plugin.settings.occuraPluginEnabledHotKey),t.inputEl.addEventListener("focus",()=>t.inputEl.value=""),t.inputEl.addEventListener("blur",()=>{t.inputEl.value||t.setValue(this.plugin.settings.occuraPluginEnabledHotKey)}),t.inputEl.addEventListener("keydown",async i=>{i.preventDefault(),i.stopPropagation();let c=this.captureHotkey(i);t.setValue(c),this.plugin.settings.occuraPluginEnabledHotKey=c,await this.plugin.saveSettings(),this.plugin.updateKeyHandler()})}),new p.Setting(s).setName("Display the number of occurrences").setDesc("Show the total count of occurrences in the status bar.").addToggle(t=>{t.setValue(this.plugin.settings.statusBarOccurrencesNumberEnabled).onChange(async i=>{this.plugin.settings.statusBarOccurrencesNumberEnabled=i,await this.plugin.saveSettings(),this.plugin.updateEditors()})});let n=e.createEl("details");n.open=this.keywordSectionOpen,n.createEl("summary",{text:"Keyword Highlighting"}),n.addEventListener("toggle",()=>{this.keywordSectionOpen=n.open}),new p.Setting(n).setName("Automatic keywords highlighting").setDesc("Highlight keywords automatically as you type.").addToggle(t=>{t.setValue(this.plugin.settings.autoKeywordsHighlightEnabled).onChange(async i=>{this.plugin.settings.autoKeywordsHighlightEnabled=i,await this.plugin.saveSettings(),this.plugin.updateEditors()})}),new p.Setting(n).setName("Keyword highlight color").setDesc("Set the color used to highlight keywords.").addText(t=>{t.inputEl.type="color",t.setValue(this.plugin.settings.highlightColorKeywords).onChange(async i=>{this.plugin.settings.highlightColorKeywords=i,await this.plugin.saveSettings(),this.plugin.updateHighlightStyle()})}),new p.Setting(n).setName("Keywords case sensitive").setDesc("Match keywords only when letter case exactly matches.").addToggle(t=>{t.setValue(this.plugin.settings.keywordsCaseSensitive).onChange(async i=>{this.plugin.settings.keywordsCaseSensitive=i,await this.plugin.saveSettings(),this.plugin.updateEditors()})});let a=document.createElement("input");a.type="file",a.accept=".txt",a.style.display="none",a.addEventListener("change",async t=>{var l;t.stopPropagation();let i=(l=t.target.files)==null?void 0:l[0];if(!i)return;let d=(await i.text()).split(/[\n,]/).map(g=>g.trim()).filter(g=>g&&!(g.startsWith('"')&&g.endsWith('"')));this.plugin.settings.keywords=d,await this.plugin.saveSettings(),this.display()}),n.appendChild(a),new p.Setting(n).addButton(t=>{t.setButtonText("Import Keywords").onClick(()=>a.click()),["mousedown","click"].forEach(i=>t.buttonEl.addEventListener(i,c=>c.stopPropagation()))}).addButton(t=>{t.setButtonText("Export Keywords").onClick(()=>{let i=new Blob([this.plugin.settings.keywords.join(",")],{type:"text/plain"}),c=URL.createObjectURL(i),d=document.createElement("a");d.href=c,d.download="keywords.txt",d.click(),URL.revokeObjectURL(c)}),["mousedown","click"].forEach(i=>t.buttonEl.addEventListener(i,c=>c.stopPropagation()))}).addButton(t=>{t.setButtonText("Add Keyword").setCta().onClick(()=>{this.plugin.settings.keywords.push(""),this.display()}),["mousedown","click"].forEach(i=>t.buttonEl.addEventListener(i,c=>c.stopPropagation()))});let u=n.createEl("div",{cls:"occura-keywords-container"});this.keywordComponents=[],this.plugin.settings.keywords.forEach((t,i)=>{let c=u.createEl("div",{cls:"occura-keyword-item"}),d=new p.TextComponent(c).setPlaceholder("Enter keyword").setValue(t).onChange(async g=>{this.plugin.settings.keywords[i]=g,await this.plugin.saveSettings()});d.inputEl.addClass("occura-keyword-input"),this.keywordComponents.push(d);let l=c.createEl("button",{text:"\u2715",cls:"occura-remove-button"});["mousedown","click"].forEach(g=>l.addEventListener(g,y=>y.stopPropagation())),l.addEventListener("click",async()=>{this.plugin.settings.keywords.splice(i,1),await this.plugin.saveSettings(),this.display()})}),new p.Setting(e).setName("Reset to defaults").addButton(t=>{t.setButtonText("Reset").setWarning().onClick(async()=>{Object.assign(this.plugin.settings,k),await this.plugin.saveSettings(),this.display()})})}captureHotkey(e){let s=[];(e.ctrlKey||e.metaKey)&&s.push("Mod"),e.shiftKey&&s.push("Shift"),e.altKey&&s.push("Alt");let n=e.key.toUpperCase();return["CONTROL","SHIFT","ALT","META"].includes(n)||s.push(n),s.join("+")}};var w=require("@codemirror/view"),S=require("@codemirror/state"),h=require("obsidian"),$=w.Decoration.mark({class:"found-occurrence",priority:100}),I=w.Decoration.mark({class:"keyword-occurrence",priority:50}),v=0;function C(r){return w.ViewPlugin.fromClass(class{constructor(o){this.view=o;this.lastOccuraPluginEnabledState=r.settings.occuraPluginEnabled,this.lastAutoKeywordsHighlightEnabledState=r.settings.autoKeywordsHighlightEnabled,this.decorations=this.createDecorations()}update(o){(o.selectionSet||o.docChanged||o.viewportChanged||r.settings.occuraPluginEnabled!==this.lastOccuraPluginEnabledState||r.settings.autoKeywordsHighlightEnabled!==this.lastAutoKeywordsHighlightEnabledState)&&(this.decorations=this.createDecorations())}createDecorations(){this.lastOccuraPluginEnabledState=r.settings.occuraPluginEnabled,this.lastAutoKeywordsHighlightEnabledState=r.settings.autoKeywordsHighlightEnabled;let{state:o}=this.view,e=[];if(v=0,r.settings.occuraPluginEnabled){let n=o.selection.main;if(n.empty)r.statusBarOccurrencesNumber&&r.settings.statusBarOccurrencesNumberEnabled&&r.statusBarOccurrencesNumber.setText("");else{let a=o.doc.sliceString(n.from,n.to).trim();if(a&&!/\s/.test(a)){let u=r.settings.occuraCaseSensitive?"g":"gi",t=new RegExp(a.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&"),u);for(let{from:i,to:c}of this.view.visibleRanges){let d=o.doc.sliceString(i,c),l;for(;(l=t.exec(d))!==null;){let g=i+l.index,y=g+l[0].length;e.push({from:g,to:y,decoration:$}),v++}}r.statusBarOccurrencesNumber&&r.settings.statusBarOccurrencesNumberEnabled&&r.statusBarOccurrencesNumber.setText(`Occura found: ${a} ${v} times`)}else r.statusBarOccurrencesNumber&&r.settings.statusBarOccurrencesNumberEnabled&&r.statusBarOccurrencesNumber.setText("")}}if(r.settings.occuraPluginEnabled&&r.settings.autoKeywordsHighlightEnabled&&r.settings.keywords.length>0){let n=r.settings.keywords.filter(a=>a.trim()!=="");if(n.length>0){let a=r.settings.keywordsCaseSensitive?"g":"gi",u=n.map(t=>{let i=t.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&");return new RegExp(`\\b${i}\\b`,a)});for(let{from:t,to:i}of this.view.visibleRanges){let c=o.doc.sliceString(t,i);u.forEach(d=>{let l;for(;(l=d.exec(c))!==null;){let g=t+l.index,y=g+l[0].length;e.push({from:g,to:y,decoration:I})}})}}}e.sort((n,a)=>n.from-a.from);let s=new S.RangeSetBuilder;for(let n of e)s.add(n.from,n.to,n.decoration);return s.finish()}},{decorations:o=>o.decorations})}function x(r){let o=r.app.workspace.getActiveViewOfType(h.MarkdownView);if(!o){new h.Notice("No active editor");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new h.Notice("Please select some text to highlight.");return}let n=s.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&"),a=new RegExp(n,"g"),u=e.getValue(),t=[],i;for(;(i=a.exec(u))!==null;)t.push({from:i.index,to:i.index+i[0].length});if(t.length===0){new h.Notice("No occurrences found.");return}let c=e.cm;if(!c){new h.Notice("Cannot access the editor view.");return}let d=t.reverse().map(l=>({from:l.from,to:l.to,insert:`==${u.slice(l.from,l.to)}==`}));c.dispatch({changes:d}),new h.Notice(`Permanently highlighted ${t.length} occurrences.`)}function K(r){let o=r.app.workspace.getActiveViewOfType(h.MarkdownView);if(!o){new h.Notice("No active editor");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new h.Notice("Please select some text to remove highlighting from.");return}let a=`==${s.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}==`,u=new RegExp(a,"g"),t=e.getValue(),i=[],c;for(;(c=u.exec(t))!==null;)i.push({from:c.index,to:c.index+c[0].length});if(i.length===0){new h.Notice("No highlighted occurrences found.");return}let d=e.cm;if(!d){new h.Notice("Cannot access the editor view.");return}let l=i.reverse().map(g=>{let y=t.slice(g.from+2,g.to-2);return{from:g.from,to:g.to,insert:y}});d.dispatch({changes:l}),new h.Notice(`Removed highlighting from ${i.length} occurrences.`)}function T(r){let o=r.app.workspace.getActiveViewOfType(h.MarkdownView);if(!o){new h.Notice("No active editor");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new h.Notice("Please select a single word to tag.");return}let n=s.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&"),a=new RegExp(`\\b${n}\\b`,"g"),u=e.getValue(),t=[],i;for(;(i=a.exec(u))!==null;)t.push({from:i.index,to:i.index+i[0].length});if(t.length===0){new h.Notice("No occurrences found.");return}t.reverse().forEach(c=>{let d=e.offsetToPos(c.from),l=e.offsetToPos(c.to),g=e.getRange(d,l);e.replaceRange(`#${g}`,d,l)}),new h.Notice(`Tagged ${t.length} occurrences.`)}function O(r){let o=r.app.workspace.getActiveViewOfType(h.MarkdownView);if(!o){new h.Notice("No active editor");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new h.Notice("Please select the tagged word to remove tags from.");return}let n=s.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&"),a=new RegExp(`#\\b${n}\\b`,"g"),u=e.getValue(),t=[],i;for(;(i=a.exec(u))!==null;)t.push({from:i.index,to:i.index+i[0].length});if(t.length===0){new h.Notice("No tagged occurrences found.");return}t.reverse().forEach(c=>{let d=e.offsetToPos(c.from),l=e.offsetToPos(c.to),g=e.getRange(d,l).replace(/^#+/,"");e.replaceRange(g,d,l)}),new h.Notice(`Removed tags from ${t.length} occurrences.`)}var P=require("obsidian");function H(r){var n;let o={ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1},e=r.split("+"),s=((n=e.pop())==null?void 0:n.toUpperCase())||"";for(let a of e)switch(a.toLowerCase()){case"mod":P.Platform.isMacOS?o.metaKey=!0:o.ctrlKey=!0;break;case"ctrl":o.ctrlKey=!0;break;case"cmd":case"meta":o.metaKey=!0;break;case"shift":o.shiftKey=!0;break;case"alt":case"option":o.altKey=!0;break;default:break}return{key:s,modifiers:o}}var E=class extends m.Plugin{async onload(){await this.loadSettings(),this.highlightCompartment=new L.Compartment,this.addSettingTab(new f(this.app,this)),this.registerEditorExtension(this.highlightCompartment.of(C(this))),this.updateHighlightStyle(),this.addCommand({id:"toggle-highlight-occurrences",name:"Toggle highlight occurrences",callback:()=>{this.toggleHighlighting()}}),this.addCommand({id:"toggle-keyword-highlighting",name:"Toggle keyword highlighting",callback:()=>{this.toggleKeywordHighlighting()}}),this.addCommand({id:"set-permanent-highlight-occurrences",name:"Set permanently highlight for occurrences",callback:()=>{this.settings.occuraPluginEnabled?x(this):new m.Notice("Please enable Occura")}}),this.addCommand({id:"remove-permanent-highlight-occurrences",name:"Remove permanently highlight for occurrences",callback:()=>{this.settings.occuraPluginEnabled?K(this):new m.Notice("Please enable Occura")}}),this.addCommand({id:"create-tag-for-occurrences",name:"Create Tag for occurrences",callback:()=>{this.settings.occuraPluginEnabled?T(this):new m.Notice("Please enable Occura")}}),this.addCommand({id:"remove-tag-from-occurrences",name:"Remove Tag for occurrences",callback:()=>{this.settings.occuraPluginEnabled?O(this):new m.Notice("Please enable Occura")}}),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.addIconsToAllLeaves()})),this.addIconsToAllLeaves(),this.updateKeyHandler()}updateKeyHandler(){this.keyHandler&&window.removeEventListener("keydown",this.keyHandler,!0);let e=H(this.settings.occuraPluginEnabledHotKey);this.keyHandler=s=>{let a=s.key.toUpperCase().replace("ARROW","");if(s.ctrlKey===e.modifiers.ctrlKey&&s.shiftKey===e.modifiers.shiftKey&&s.altKey===e.modifiers.altKey&&s.metaKey===e.modifiers.metaKey&&a===e.key)return s.preventDefault(),s.stopPropagation(),this.toggleHighlighting(),!1},window.addEventListener("keydown",this.keyHandler,!0)}async loadSettings(){this.settings=Object.assign({},k,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}toggleHighlighting(){this.settings.occuraPluginEnabled=!this.settings.occuraPluginEnabled,this.saveSettings(),this.updateEditors(),this.updateAllTitleBarIcons()}toggleKeywordHighlighting(){this.settings.autoKeywordsHighlightEnabled=!this.settings.autoKeywordsHighlightEnabled,this.saveSettings(),this.updateEditors()}handleDocumentClick(e){if(!e.target.closest(".cm-content")){let n=this.app.workspace.getActiveViewOfType(m.MarkdownView);n&&n.editor.setCursor(n.editor.getCursor())}}updateHighlightStyle(){this.styleEl&&this.styleEl.remove(),this.styleEl=document.createElement("style"),this.styleEl.textContent=`
        .found-occurrence {background-color: ${this.settings.highlightColorOccurrences};}
        .keyword-occurrence { background-color: ${this.settings.highlightColorKeywords}; }
    `,document.head.appendChild(this.styleEl)}updateEditors(){let e=this.app.workspace.getLeavesOfType("markdown").map(s=>s.view).filter(s=>s instanceof m.MarkdownView);for(let s of e){let n=s.editor.cm;n&&n.dispatch({effects:this.highlightCompartment.reconfigure(C(this))})}}addIconsToAllLeaves(){let e=this.app.workspace.getLeavesOfType("markdown");for(let s of e)this.addTitleBarIcon(s)}addTitleBarIcon(e){if(!(e.view instanceof m.MarkdownView))return;let s=e.view,n=s.containerEl.querySelector(".highlight-toggle-icon");n&&n.remove();let a=document.createElement("div");a.addClass("highlight-toggle-icon","clickable-icon"),this.updateIconElement(a),a.addEventListener("click",()=>{this.toggleHighlighting()});let u=s.containerEl.querySelector(".view-header");if(u){let t=u.querySelector(".view-actions");t&&t.insertBefore(a,t.firstChild)}}updateAllTitleBarIcons(){document.querySelectorAll(".highlight-toggle-icon").forEach(s=>{this.updateIconElement(s)})}updateIconElement(e){e.empty(),(0,m.setIcon)(e,"highlighter"),this.settings.occuraPluginEnabled?(this.statusBarOccurrencesNumber||(this.statusBarOccurrencesNumber=this.addStatusBarItem()),(0,m.setTooltip)(e,"Disable highlighting"),e.removeClass("is-disabled")):((0,m.setTooltip)(e,"Enable highlighting"),e.addClass("is-disabled"))}onunload(){window.removeEventListener("keydown",this.keyHandler,!0),this.styleEl&&this.styleEl.remove(),document.querySelectorAll(".highlight-toggle-icon").forEach(s=>s.remove())}};

/* nosourcemap */