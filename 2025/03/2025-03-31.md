---
åˆ›å»ºæ—¶é—´: 2025-ä¸‰æœˆ-31æ—¥  æ˜ŸæœŸä¸€, 2:10:25 ä¸‹åˆ
---

# ä¸€å †æ§åˆ¶å˜é‡ï¼Œå˜é‡ï¼š 

1.  `omg_buffer` ç›¸å…³
	1. å®šæœŸæ¸…é™¤ `buffer`  å†…çš„å†å²è½¨è¿¹ï¼Œæ›´æ–°
	2. å†™ä¸ºå’Œ `moa_buffer` ç±»ä¼¼çš„å¤„ç† $\Longrightarrow$ ==åˆå¹¶==
2. é‡å»ºæŸå¤± `recon_loss`  çš„ä¼˜åŒ–ï¼š 
	1. ç›®æ ‡ç»´åº¦å˜åŒ– $64$ $\Longrightarrow$ $16$ $\Longrightarrow$ $4$ $\Longrightarrow$ $2$ ï¼Œä½¿å¾—è®­ç»ƒ `loss` æ²¡é‚£ä¹ˆ ä½ ä¸” ä¸æ˜æ˜¾
3. `MCTS` æ ‘çš„æ•°é‡å˜åŒ– $\Longrightarrow$ è®­ç»ƒæ›´é²æ£’  $1$ $\Longrightarrow$ $5$
	-  å¯ç”¨ `for` å¾ªç¯å¤„ç†å¤šæ£µæ ‘ï¼Œä¸ä¸€å®šç”¨ `pool` (å› ä¸ºåè€…åªèƒ½ä½¿ç”¨CPU)


# goal_dim ç”± 16 $\Longrightarrow$ 4 $\Longrightarrow$ 2 çš„å˜åŒ–ï¼š 

`loss` æ— æ˜æ˜¾å˜åŒ–ã€‚


# tree_num  æ”¹ä¸º 5 
å¥–åŠ±äº›è®¸ä¸Šå‡ã€‚

```markdown
`goal` ç»´åº¦ ï¼š 64 - > 16

`tree_num` : 1 - > 5 

`vae` : offline rule based agents (3.24)

`reward` : 4.5 +- 0.5

```

![[episode_vs_policy_rewards.png]]


# åˆ†æ omg è®­ç»ƒ bug

- **OMG_AM çš„è®­ç»ƒæ•°æ®**ï¼šæ˜¯é€šè¿‡åœ¨ `postprocess_trajectory()` ä¸­æ˜¾å¼è°ƒç”¨ `self.runner.run()` é‡æ–°æ‰§è¡Œä¸€é episode å¾—åˆ°çš„ã€‚  
  > è¿™æ„å‘³ç€ï¼šOMG ä½¿ç”¨çš„æ˜¯â€œå½“å‰ç¯å¢ƒå†è·‘ä¸€æ¬¡â€çš„å®Œæ•´ episodeï¼Œ**è€Œä¸æ˜¯å½“å‰ episode çš„å†…å®¹**ã€‚

- **MOA çš„è®­ç»ƒæ•°æ®**ï¼šæ˜¯ç›´æ¥ä» **å½“å‰ episode ä¸­çš„å…¶ä»– agent çš„æ•°æ®**ï¼ˆå¦‚ obsã€actionsã€subgoalï¼‰é‡‡æ ·å¾—åˆ°çš„ã€‚

---

### ğŸ§  è¿™ä¼šå¸¦æ¥çš„é—®é¢˜ï¼š

| é—®é¢˜ | è¯´æ˜ |
|------|------|
| âŒ æ•°æ®å†—ä½™ | `self.runner.run()` ä¼šé¢å¤–ç”Ÿæˆä¸€ä¸ª episodeï¼Œç›¸å½“äºæ¯ä¸€æ¬¡ `postprocess` éƒ½åœ¨é¢å¤–é‡‡æ ·ï¼Œå¢åŠ è®­ç»ƒä¸ä¸€è‡´æ€§ä¸è®¡ç®—è´Ÿæ‹… |
| âŒ ä¸ä¸€è‡´æ€§ | å½“å‰ postprocess çš„ episode ä¸ OMG buffer å­˜å‚¨çš„ episode ä¸ä¸€è‡´ï¼Œå¯èƒ½å¯¼è‡´æ¨¡å‹ç›®æ ‡ï¼ˆå¦‚ subgoal çš„è¯­ä¹‰ï¼‰è®­ç»ƒåå·® |
| âŒ è®­ç»ƒä¿¡å·å»¶è¿Ÿ | å¦‚æœç›®æ ‡ç½‘ç»œæ˜¯åœ¨å½“å‰è½¨è¿¹ä¸­å­¦ä¹ çš„ï¼Œä½†è®­ç»ƒæ•°æ®æ¥è‡ªä¸åŒ episodeï¼Œå¯èƒ½ä¼šå¯¼è‡´å­¦ä¹ æ»åæˆ–å¯¹æŠ—å¤±æ•ˆ |

---

###  æ”¹ä¸ºä½¿ç”¨ **å½“å‰ episode çš„æ•°æ®** å­˜å…¥ OMG bufferã€‚








# æœ‰å…³ HOP çš„ beliefï¼š

## åŸå§‹ HOP ä¸­çš„ä¸¤ä¸ªæ¨¡å—å«ä¹‰

| æ¨¡å— | å«ä¹‰ | æ›´æ–°é¢‘ç‡ | æ ¸å¿ƒä½œç”¨ |
|------|------|------------|-----------|
| **Intra-OM** | å½“å‰ episode å†…ï¼ŒåŸºäºè½¨è¿¹å®æ—¶æ›´æ–° belief | æ¯ä¸€æ­¥ | å¿«é€Ÿé€‚åº”å¯¹æ‰‹ç›®æ ‡å˜åŒ– |
| **Inter-OM** | è·¨ episodeï¼Œæ€»ç»“è¿‡å» episode ä¸­ co-player çš„ç›®æ ‡åå¥½ï¼ˆpriorï¼‰ | æ¯ä¸ª episode èµ·ç‚¹ | æä¾›åˆç†çš„å…ˆéªŒ |

---

## ç°åœ¨OMGçš„ä¸¤ä¸ªæ¨¡å—æ˜¯ï¼š

| æ¨¡å— | ä½ ä½¿ç”¨çš„æœºåˆ¶ | æƒ³ç±»æ¯”è° |
|------|---------------|-----------|
| RNN encoderï¼ˆcond_xï¼‰ | ç¼–ç å½“å‰ episode çš„å†å²è½¨è¿¹ $h_{0:t-1}$ â†’ cond_x | ç±»ä¼¼ intra-OM |
| Subgoal selectorï¼ˆhindsightï¼‰ | ä»è¿‡å» episode çš„æœªæ¥ç‰‡æ®µé€‰ subgoal â†’ $\bar{g}$ | ç±»ä¼¼ inter-OM |

---

### RNN â‰ˆ Intra-OMï¼ˆå¤§ä½“åˆç†ï¼‰

**ç›¸ä¼¼ä¹‹å¤„**ï¼š
- éƒ½åœ¨ episode å†…æ›´æ–°ï¼›
- éƒ½è¯•å›¾æ•æ‰ç›®æ ‡åœ¨å½“å‰ episode ä¸­æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼›
- cond_x ç±»ä¼¼äº belief çš„ context embeddingã€‚

**ä¸åŒç‚¹**ï¼š
- åŸ intra-OM æ˜¯ä¸€ä¸ª **æ˜¾å¼çš„ belief** over discrete goalsï¼›
- è€Œ RNN æ˜¯ä¸€ä¸ª **éšå¼çš„è¡¨ç¤º**ï¼Œæ²¡æœ‰è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒï¼›
- Intra-OM æ˜¯å¯ä»¥è´å¶æ–¯æ›´æ–°çš„ï¼Œè€Œ RNN æ˜¯å‰é¦ˆ / é¡ºåºæ›´æ–°ï¼Œæ— æ³•æ§åˆ¶å†…éƒ¨æƒé‡ä»£è¡¨ä»€ä¹ˆç›®æ ‡ã€‚


---

### Subgoal Selector â‰ˆ Inter-OMï¼ˆå·®åˆ«æ›´å¤§ï¼‰


**å…³é”®ä¸åŒ**ï¼š

| åŸ Inter-OM | Subgoal Selector |
|-------------|------------------|
| æ€»ç»“å¤šä¸ª past episodes çš„ç›®æ ‡ç»Ÿè®¡ï¼ˆå¦‚æŠ“äº†å‡ æ¬¡é¹¿ï¼‰ | åªä»å½“å‰ episode å‘åé€‰æ‹© |
| æ˜ç¡®å»ºæ¨¡ç›®æ ‡çš„æ¦‚ç‡åˆ†å¸ƒ $p(g)$ | è¾“å‡ºä¸€ä¸ªç›®æ ‡ embeddingï¼Œæ²¡æœ‰åˆ†å¸ƒå«ä¹‰ |
| ä¸º belief æä¾›å¯è´å¶æ–¯çš„å…ˆéªŒ | æä¾›çš„æ˜¯è®­ç»ƒ signalï¼Œè€Œä¸æ˜¯æ¨ç†å…ˆéªŒ |

ä¹Ÿå°±æ˜¯è¯´ï¼š

> âœ… subgoal selector æ›´åƒæ˜¯ä¸€ä¸ªâ€œteacher signalâ€ â€”â€” ç”¨äºè®­ç»ƒç›®æ ‡çš„ ground truthï¼Œä¸ç›´æ¥ç”¨äºæ¨¡å‹æ¨ç†ã€‚
>
> âŒ è€ŒåŸæ¥çš„ inter-OM æ˜¯ **policy æ¨ç†ç”¨çš„å…ˆéªŒ belief**ï¼Œæ˜¯çœŸæ­£å‚ä¸åœ¨çº¿è¡Œä¸ºå»ºæ¨¡çš„ã€‚








$a|z,s_{t}$

state é¢„æµ‹ next_t a

ç¦»æ•£åŒ– èšç±» 



online è°ƒæ•´ vae 