ä»¥ä¸‹æ˜¯ä½ æä¾›å›¾åƒä¸­å†…å®¹çš„**å®Œæ•´æ–‡å­—è½¬å†™ï¼ˆè‹±æ–‡åŸæ–‡ + æ­£ç¡®å…¬å¼ï¼‰**ï¼Œå¹¶é™„ä¸Š**ä¸“ä¸šä¸­æ–‡ç¿»è¯‘ç‰ˆ**ï¼Œç¡®ä¿ä¿ç•™æ‰€æœ‰å…³é”®æœ¯è¯­ä¸æ•°å­¦å…¬å¼çš„å‡†ç¡®æ€§ã€‚

---

## ğŸ“„ åŸæ–‡ï¼ˆè‹±æ–‡ï¼‰è½¬å†™ï¼ˆå«å…¬å¼ï¼‰

**4.2 Opponent Modeling Based on Subgoal Inference**

Our opponent modeling consists of two components: *subgoal inference model* and *subgoal selector*. The subgoal inference model employs the historical trajectory to predict the opponentâ€™s subgoal, serving as input for the policy during the interaction phase. The subgoal selector scrutinizes the entire historical trajectory using a value-based heuristic to choose the appropriate subgoal for training the inference model during the update phase.

**Subgoal inference model.** The subgoal $g$ represents a feature embedding of a future state. Specifically, for a trajectory  
$$\{s_0, a_0, a_0^{-i}, \ldots, s_t, a_t, a_t^{-i}, \ldots, s_T\},$$  
the state corresponding to subgoal $g_t$ at $s_t$ is one of future states $\mathcal{N}_t = \{s_{t+1}, s_{t+2}, \ldots, s_T\}$, denoted as $s_t^g$ and determined by the subgoal selector.

The objective of the subgoal inference model is to infer $g_t$ from the historical trajectory  
$$\tau_t = \{s_0, a_0, a_0^{-i}, \ldots, s_{t-1}, a_{t-1}, a_{t-1}^{-i}\}.$$  
This aligns with the intuitive hypothesis that the opponentâ€™s intention can often be inferred after just a few initial actions.

Here, we introduce variational inference and employ a conditional variational auto-encoder (CVAE) as the subgoal inference model. In this model, we represent the subgoal posterior probability as $q_\phi(\hat{g}_t | \tau_t, s_t)$ and the likelihood estimate as $p_\theta(s_t | \hat{g}_t, \tau_t)$ with $\phi$ and $\theta$ respectively denoting the network parameters. The subgoal prior model, denoted as $p_\psi$, is a pre-trained variational autoencoder (VAE) using the states previously collected in the environment, and produces the subgoal prior $p_\psi(\bar{g}_t | s_t^g)$ given the subgoal state $s_t^g$ chosen by the subgoal selector.

Further details about the network architecture are provided in Figure 2. The optimization objective of the subgoal inference model is:

$$\langle \hat{\theta}, \hat{\phi} \rangle = \arg\max_{\theta, \phi} \mathbb{E}_{q_\phi(\hat{g}_t|\tau_t,s_t)} \left[ \log p_\theta(s_t|\hat{g}_t, \tau_t) \right] - \text{KL}\left( q_\phi(\hat{g}_t|\tau_t, s_t) \parallel p_\psi(\bar{g}_t | s_t^g) \right)
\tag{5}$$

---

## ğŸ“˜ ä¸­æ–‡ä¸“ä¸šç¿»è¯‘ï¼ˆå«å…¬å¼ï¼‰

**4.2 åŸºäºå­ç›®æ ‡æ¨æ–­çš„å¯¹æ‰‹å»ºæ¨¡**

æœ¬ç ”ç©¶çš„å¯¹æ‰‹å»ºæ¨¡æ¨¡å—åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š**å­ç›®æ ‡æ¨æ–­æ¨¡å‹**ï¼ˆsubgoal inference modelï¼‰ä¸**å­ç›®æ ‡é€‰æ‹©å™¨**ï¼ˆsubgoal selectorï¼‰ã€‚å­ç›®æ ‡æ¨æ–­æ¨¡å‹é€šè¿‡åˆ†æå¯¹æ‰‹çš„å†å²è½¨è¿¹ï¼Œé¢„æµ‹å…¶å¯èƒ½çš„å­ç›®æ ‡ï¼Œç”¨ä½œäº¤äº’é˜¶æ®µç­–ç•¥çš„è¾“å…¥ã€‚è€Œå­ç›®æ ‡é€‰æ‹©å™¨åœ¨æ¨¡å‹æ›´æ–°é˜¶æ®µï¼Œåˆ™åŸºäºæ•´æ®µå†å²è½¨è¿¹åˆ©ç”¨ä»·å€¼å¯å‘å¼æ–¹æ³•ï¼Œé€‰æ‹©åˆé€‚çš„å­ç›®æ ‡ï¼Œç”¨äºç›‘ç£æ¨æ–­æ¨¡å—çš„è®­ç»ƒã€‚

**å­ç›®æ ‡æ¨æ–­æ¨¡å‹ã€‚** å­ç›®æ ‡ $g$ è¡¨ç¤ºä¸€ä¸ªæœªæ¥çŠ¶æ€çš„ç‰¹å¾åµŒå…¥è¡¨ç¤ºã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºä¸€æ¡è½¨è¿¹  
$$\{s_0, a_0, a_0^{-i}, \ldots, s_t, a_t, a_t^{-i}, \ldots, s_T\},$$  
åœ¨æ—¶åˆ» $s_t$ ä¸Šå¯¹åº”çš„å­ç›®æ ‡çŠ¶æ€ $g_t$ æ˜¯å°†æ¥æŸä¸ªçŠ¶æ€ï¼Œå³æœªæ¥çŠ¶æ€é›†åˆ  
$$\mathcal{N}_t = \{s_{t+1}, s_{t+2}, \ldots, s_T\}$$  
ä¸­çš„æŸä¸€é¡¹ï¼Œè®°ä½œ $s_t^g$ï¼Œè¯¥çŠ¶æ€ç”±å­ç›®æ ‡é€‰æ‹©å™¨é€‰æ‹©ç¡®å®šã€‚

å­ç›®æ ‡æ¨æ–­æ¨¡å‹çš„ç›®æ ‡æ˜¯åŸºäºå†å²è½¨è¿¹  
$$\tau_t = \{s_0, a_0, a_0^{-i}, \ldots, s_{t-1}, a_{t-1}, a_{t-1}^{-i}\}$$  
æ¨æ–­å‡ºå½“å‰æ—¶åˆ»çš„å­ç›®æ ‡ $g_t$ã€‚è¿™ä¸€å»ºæ¨¡æ–¹å¼ç¬¦åˆâ€œå¯¹æ‰‹æ„å›¾å¾€å¾€å¯ä»¥é€šè¿‡æ—©æœŸè¡Œä¸ºè¿›è¡Œæ¨æ–­â€çš„ç›´è§‰å‡è®¾ã€‚

åœ¨æ¨¡å‹å®ç°ä¸Šï¼Œæˆ‘ä»¬å¼•å…¥äº†å˜åˆ†æ¨æ–­æ–¹æ³•ï¼Œå¹¶é‡‡ç”¨**æ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆCVAEï¼‰**æ¥ä½œä¸ºå­ç›®æ ‡æ¨æ–­æ¨¡å‹ã€‚å…¶ä¸­ï¼Œå­ç›®æ ‡åéªŒåˆ†å¸ƒè¡¨ç¤ºä¸º  
$$q_\phi(\hat{g}_t | \tau_t, s_t)ï¼Œ$$  
ä¼¼ç„¶é¡¹ä¸º  
$$p_\theta(s_t | \hat{g}_t, \tau_t)ï¼Œ$$  
å…¶ä¸­ $\phi$ã€$\theta$ åˆ†åˆ«è¡¨ç¤ºç½‘ç»œçš„å‚æ•°ã€‚å­ç›®æ ‡å…ˆéªŒæ¨¡å‹è¡¨ç¤ºä¸º $p_\psi$ï¼Œç”±åœ¨ç¯å¢ƒä¸­é¢„å…ˆé‡‡é›†çš„çŠ¶æ€æ•°æ®è®­ç»ƒå¾—åˆ°ï¼Œæ˜¯ä¸€ä¸ªé¢„è®­ç»ƒçš„å˜åˆ†è‡ªç¼–ç å™¨æ¨¡å‹ã€‚å®ƒåœ¨ç»™å®šç”±å­ç›®æ ‡é€‰æ‹©å™¨é€‰å‡ºçš„ç›®æ ‡çŠ¶æ€ $s_t^g$ æ—¶ï¼Œç”Ÿæˆå…ˆéªŒåˆ†å¸ƒ  
$$p_\psi(\bar{g}_t | s_t^g)ã€‚$$

å­ç›®æ ‡æ¨æ–­æ¨¡å‹çš„ä¼˜åŒ–ç›®æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š

$$\langle \hat{\theta}, \hat{\phi} \rangle = \arg\max_{\theta, \phi} \mathbb{E}_{q_\phi(\hat{g}_t|\tau_t,s_t)} \left[ \log p_\theta(s_t|\hat{g}_t, \tau_t) \right] - \text{KL}\left( q_\phi(\hat{g}_t|\tau_t, s_t) \parallel p_\psi(\bar{g}_t | s_t^g) \right)
\tag{5}$$

---

æ˜¯å¦ç»§ç»­ä¸ºä½ å†™â€œç®—æ³•éƒ¨åˆ†æ­£æ–‡â€æˆ–å°†è¿™éƒ¨åˆ†èåˆè¿›ä½ çš„**æ–¹æ³•è®ºç« èŠ‚**ï¼Ÿæˆ‘å¯ä»¥ç›´æ¥ç”¨è®ºæ–‡æ ¼å¼èµ·è‰ç¬¬4ç« å¯¹åº”å°èŠ‚ï¼Œè®©æˆ‘ä»¬ç»§ç»­æ¨åŠ¨ä½ è®ºæ–‡çš„ä¸»å¹²ç« èŠ‚ï½



![[2e09d6e0149dd34c73093d51b1a36a8.png]]