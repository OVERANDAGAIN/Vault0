---
åˆ›å»ºæ—¶é—´: 2025-ä¸ƒæœˆ-21æ—¥  æ˜ŸæœŸä¸€, 3:20:39 ä¸‹åˆ
---

## 1. å½“å‰æ•´åˆè¿›å±•

1. æ•´åˆ CleanRL + å¤šç­–ç•¥  +  rollout çš„è®­ç»ƒæµç¨‹ï¼›
2.  rollout æ”¯æŒå¤šæ™ºèƒ½ä½“çš„ä¸­é€”ç»ˆæ­¢ä¸ action maskï¼›
3. æ•´ä½“è®­ç»ƒæµç¨‹å¯è·‘é€šï¼Œè®­ç»ƒä¸è¯„ä¼°ç»“æ„ã€‚
	1. rule-based policy ç­‰ç»“æœç¬¦åˆ

---

## 2. ReplayBuffer æ¨¡å—æ˜¯å¦éœ€è¦æ•´ä½“è¿ç§»ï¼Ÿ

1. å½“å‰è¿ç§»è¿›å±•å¡åœ¨åŸç³»ç»Ÿä¸­çš„ OMG æ¨¡å— buffer ç®¡ç†é€»è¾‘ï¼›
2. åŸä»£ç ä¸­ OMG æ¨¡å—ä½¿ç”¨ `ReplayBuffer` + `EpisodeBatch`ï¼›
3. æ”¯æŒäº† subgoal æ¨ç†ã€è½¨è¿¹å¯¹é½ã€å¤š agent æ•°æ®ç»“æ„ã€é«˜çº§é‡‡æ ·æœºåˆ¶ç­‰åŠŸèƒ½ã€‚

---

### OMG Buffer çš„ç»“æ„ç‰¹å¾

1. æ”¯æŒ agent-wise segmentï¼ˆæ¯ä¸ª agent çš„å®Œæ•´ episodeï¼‰ï¼›
2. ä½¿ç”¨ `filled`ã€`terminated` å­—æ®µå¤„ç†å¼‚æ­¥é€€å‡ºã€åŠ¨æ€æˆªæ–­ï¼›
3. å¯å­˜å‚¨ `subgoal`ã€`avail_actions`ã€`time` ç­‰è¾…åŠ©å­—æ®µï¼›
4. å¯é€šè¿‡ `can_sample()` åˆ¤æ–­æ˜¯å¦æ»¡è¶³é‡‡æ ·è®­ç»ƒæ¡ä»¶ï¼›
5. `scheme/group` æ”¯æŒå¤š agent åˆ†ç»„å¤„ç†ä¸åŠ¨æ€å­—æ®µæ’å…¥ï¼›
6. ReplayBuffer å¯è¢«å¤šæ¬¡è®­ç»ƒã€æ”¯æŒè·¨ batch éšæœºé‡‡æ ·ã€‚


---

### å½“å‰ CleanRL Buffer çš„å±€é™

1. å½“å‰ä½¿ç”¨ç®€åŒ–ç»“æ„å¦‚ `transition`, `agent_traj`ï¼›
2. rollout å›ºå®šé•¿åº¦ï¼Œä¸æ”¯æŒåŠ¨æ€è£å‰ªï¼ˆå¦‚ OMG ä¸­çš„ `max_t_filled()`ï¼‰ï¼›

> å½“å‰æˆ‘ä»¬ CleanRL ç§»æ¤ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯è¾ƒä¸ºç®€åŒ–çš„ `transition` å’Œ `agent_traj` æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿæ»¡è¶³ rollout ä¸åŸºæœ¬è®­ç»ƒï¼Œä½†åœ¨å¤„ç†å¤šæ™ºèƒ½ä½“å¼‚æ­¥ç»ˆæ­¢ã€subgoal æ¨ç†ï¼ˆå¦‚æ—¶é—´å¯¹é½ã€å¡«å……ã€è·¨ agent ç»„ç»‡ï¼‰æ—¶å­˜åœ¨ä¸€å®šå±€é™ã€‚

---


> 1. **å®Œå…¨è¿ç§»** OMG buffer ç³»ç»Ÿï¼›
> 2. **åœ¨ç°æœ‰ç»“æ„ä¸Š patch å¼‚æ­¥ç»ˆæ­¢é€»è¾‘å’Œsubgoalå­˜å‚¨**ã€‚





## Contents
![[c3c7eec4056d30f030741b932a51e1c5_720.jpg]]

1. moa çš„åˆ©ç”¨ï¼Œactionæœ€ç›´è§‚å°±æ˜¯åº”ç”¨åœ¨ planning ä¸­ï¼Œç°åœ¨å»é™¤äº†MCTSï¼Œéœ€è¦è€ƒè™‘å¦‚ä½•è¿è¡Œactionè¿›å»
2. Dreamer
3. è®¨è®ºä¸QOM, OMGçš„åŒºåˆ«ç­‰ï¼Œ
	1. é¦–å…ˆæ˜¯ goal çš„é€‰æ‹©ï¼Œå…¶æ¬¡æ˜¯goalçš„å‡†ç¡®åº¦ï¼šæ˜¯å¦å¯ä»¥æŠŠå¤šæ ·åŒ–çš„å¯¹æ‰‹å½’ç±»ä¸ºå‡ ç§ç±»å‹ï¼ˆæˆ–è€…goalç§ç±»ï¼‰ ï¼›èƒ½å¦åŒºåˆ†ä¸åŒçš„ç­–ç•¥ï¼Œå‡†ç¡®åˆ»ç”»å¯¹æ‰‹
	2. ä¸OMGç›¸æ¯”ï¼ŒOMGæ˜¯é¢„æµ‹çš„stateï¼Œæˆ‘ä»¬æ˜¯é¢„æµ‹çš„actionï¼Œæ›´æ³¨é‡å¯¹æ‰‹çš„è¡Œä¸ºæ¨¡å¼ï¼Ÿ
	3. ä¸QOMç›¸æ¯”ï¼Œå¸Œæœ›å¯ä»¥æ›¿æ¢æ‰MCTSè¿™ä¸ªsimulatorçš„éƒ¨åˆ†
4. å…³äºgoalä½•æ—¶é¢„æµ‹çš„é—®é¢˜ï¼šé¢å¯¹ç¨€ç–çš„å¥–åŠ±ï¼Œé¢å¯¹ç¨ å¯†çš„å¥–åŠ±ï¼ˆå¯è¿‡æ»¤ä¸€å®šå¤§å°ç¨‹åº¦çš„å¥–åŠ±æ¥åˆ©ç”¨ï¼‰
5. å¦‚ä¸‹ï¼š

- 

$$
P(o_i^{t+1} \mid o_i^t, a_j^t, a_i^t)
$$

- 

$$
a_i^{t*} = \arg\max_{a_{i}^{t}} \sum_{o_i^{t+1}} P(o_i^{t+1} \mid o_i^t, a_j^t, a_i^t)V(o_{i}^{t+1})
$$



- å¦å¤–ï¼Œ ä»¿ç…§Dreamerçš„æ€è·¯ï¼Œç”¨embeddingè¡¨ç¤ºoï¼Œé˜²æ­¢ç¨€ç–è§‚æµ‹å¯¼è‡´çš„losséš¾ä»¥è®¡ç®—ç­‰é—®é¢˜

$$
f(o_{i}^{t+1}) = e_{i}^{t+1}
$$



---




å¥½çš„ï¼Œä»¥ä¸‹æ˜¯ç™½æ¿ä¸Šè¯†åˆ«å‡ºçš„æ‰€æœ‰å…¬å¼ï¼Œä½¿ç”¨æ ‡å‡†æ•°å­¦å…¬å¼æ ¼å¼ï¼ˆLaTeX å½¢å¼ï¼‰è¾“å‡ºï¼š

---

### ğŸ§© å³ä¸Šéƒ¨åˆ†ï¼šç›®æ ‡å»ºæ¨¡ä¸å¯¹æ‰‹åŠ¨ä½œé¢„æµ‹

1.

$$
\text{goal} \rightarrow g_{j} \rightarrow a_j'
$$

2.

$$
\pi(a_i \mid o_i^t, g_{j},a_{j}')
$$


---

---

### ğŸ§© å·¦ä¾§

1.

$$
P(o_i^{t+1} \mid o_i^t, a_j^t, a_i^t)
$$

2.

$$
a_i^{t*} = \arg\max_{a_{i}^{t}} \sum_{o_i^{t+1}} P(o_i^{t+1} \mid o_i^t, a_j^t, a_i^t)V(o_{i}^{t+1})
$$



3.å¦å¤–ï¼Œ ä»¿ç…§Dreamerçš„æ€è·¯ï¼Œç”¨embeddingè¡¨ç¤ºoï¼Œé˜²æ­¢ç¨€ç–è§‚æµ‹å¯¼è‡´çš„losséš¾ä»¥è®¡ç®—ç­‰é—®é¢˜

$$
f(o_{i}^{t+1}) = e_{i}^{t+1}
$$




æ›´æ–°åçš„9å¼ï¼ˆå¦‚ä¸‹ï¼Œä½ æ›´æ–°ä¸€ä¸‹ï¼‰


![[Pasted image 20250721211540.png]]




æ˜ç™½äº†ï¼Œä½ æƒ³å°†ç¬¬9å¼æ›´æ–°ä¸º**åŸºäº Dreamer é£æ ¼çš„ embedding å½¢å¼**ï¼Œå³ä¸å†ç›´æ¥å¯¹ raw observation $o_i^{t+1}$ åš value è¯„ä¼°ï¼Œè€Œæ˜¯å…ˆå°†å…¶æ˜ å°„ä¸º embeddingï¼Œå†å¯¹ embedding è¿›è¡Œä»·å€¼è¯„ä¼°ã€‚

---

## âœ… æ›´æ–°é‡ç‚¹

æˆ‘ä»¬ä¿ç•™åŸæ¥çš„ï¼š

8.

$$
P(o_i^{t+1} \mid o_i^t, a_j^t, a_i^t)
$$

---

## ğŸ”„ æ–°å®šä¹‰ï¼š

11.

$$
f(o_i^{t+1}) = e_i^{t+1}
$$

> å³å°† raw observation æ˜ å°„ä¸º latent embeddingï¼ˆç±»ä¼¼ Dreamer ä¸­çš„ representation learningï¼‰

---

## âœ… æ›´æ–°åçš„ 9 å¼ï¼ˆä½¿ç”¨ embedding è¡¨ç¤ºå¹¶è¿›è¡Œ planningï¼‰ï¼š

9'.

$$
a_i^{t*} = \arg\max_{a_i^t} \sum_{o_i^{t+1}} P(o_i^{t+1} \mid o_i^t, a_j^t, a_i^t) \cdot V(f(o_i^{t+1}))
$$

æˆ–å†™æˆæ›´æ¸…æ™°çš„å½¢å¼ï¼ˆæ˜¾å¼å¸¦ä¸Š $e_i^{t+1}$ï¼‰ï¼š

$$
a_i^{t*} = \arg\max_{a_i^t} \sum_{o_i^{t+1}} P(o_i^{t+1} \mid o_i^t, a_j^t, a_i^t) \cdot V(e_i^{t+1}), \quad \text{where } e_i^{t+1} = f(o_i^{t+1})
$$
