---
åˆ›å»ºæ—¶é—´: 2025-å…«æœˆ-4æ—¥  æ˜ŸæœŸä¸€, 12:19:26 ä¸­åˆ
---
ä½ çš„åˆ†ææ˜¯**å‡†ç¡®ä¸”å…³é”®çš„**ï¼Œæˆ‘æ¥ä»ä¸¤ä¸ªè§’åº¦è¿›è¡Œæ›´æ·±å…¥çš„è§£æå’Œä¼˜åŒ–å»ºè®®ï¼š

---

## ğŸ¯ ä¸€ã€é—®é¢˜åˆ†æ

### 1. å½“å‰é¢„æµ‹ä»»åŠ¡ç‰¹æ€§

ä½ é¢„æµ‹çš„æ˜¯ `next_state`ï¼Œå…¶ channel å«ä¹‰å¤§æ¦‚ç‡ä¸ºï¼š

* `channel 0-1`ï¼šagent 0, 1 çš„ä½ç½®ï¼›
* `channel 2`ï¼šstagï¼›
* `channel 3`ï¼šhareï¼›
* `channel 4`ï¼šblockï¼›

è€Œå…¶ä¸­ï¼š

* `block` æ˜¯é™æ€ä¸å˜çš„ï¼ˆchannel 4ï¼‰ï¼›
* `stag/hare` åœ¨ç§»åŠ¨å‰å¯èƒ½é™æ­¢ï¼ˆchannel 2/3ï¼‰ï¼›
* å”¯ä¸€é¢‘ç¹å˜åŒ–çš„æ˜¯ `agent` çš„ä½ç½®ï¼ˆchannel 0-1ï¼‰ï¼›

### 2. ä¸ºä»€ä¹ˆ loss å¾ˆä½ä½†é¢„æµ‹å·®

* é™æ€å…ƒç´ å æ®ç©ºé—´å¤§ï¼Œä¸”æ•°å€¼ç¨³å®šï¼ˆå…¨ 0 or 1ï¼‰ï¼›
* å°‘æ•° agent çš„ä½ç½®ä¿¡æ¯è¢«â€œæ·¹æ²¡â€åœ¨æ•´ä½“ loss é‡Œï¼›
* ç§»åŠ¨ agent çš„ä½ç½®å˜åŒ–å°ï¼ˆä¸€æ­¥ 1 pixelï¼‰ï¼Œå¯¹ loss å½±å“æå°ï¼›
* å¤šæ•°æ—¶é—´ agent æ˜¯â€œç©ºç™½ç§»åŠ¨â€ï¼Œç›®æ ‡åŒºåŸŸ sparsity é«˜ â†’ å®¹æ˜“è¿‡æ‹Ÿåˆ backgroundï¼›

---

## ğŸ§  äºŒã€æ•çŒé¢„æµ‹æ›´å‡†çš„åŸå› 

* æ•çŒæ—¶ï¼Œagent ä¸ hare/stag åŒæ—¶ä» `1 â†’ 0`ï¼Œä½ç½®æ¶ˆå¤±ï¼Œ**è¿™ä¸ªå˜åŒ–éå¸¸æ˜¾è‘—**ï¼›
* æ•çŒçŠ¶æ€å¯è§†ä¸º â€œç¨€ç–ç›®æ ‡çªç„¶æ¶ˆå¤±â€ï¼Œæ¨¡å‹è¾ƒå®¹æ˜“è®°å¿†æˆ–å­¦ä¹ ï¼›
* ä½†ç§»åŠ¨åªæ˜¯ä¸€æ ¼æŒªåŠ¨ï¼ŒèƒŒæ™¯å‡ ä¹ä¸å˜ï¼Œé¢„æµ‹éš¾åº¦å¤§ï¼Œä½† loss å´ä½ï¼ˆå› ä¸ºå¤§å¤šæ•°åƒç´ ä¸å˜ï¼‰ï¼›

---

## âœ… ä¸‰ã€ä¼˜åŒ–å»ºè®®

### ğŸŒŸ æ–¹æ¡ˆ 1ï¼šå¼•å…¥ **agent-centric lossï¼ˆèšç„¦ agent åŒºåŸŸï¼‰**

å¯¹ agent çš„ä½ç½®åšä¸“é—¨çš„ loss è®¡ç®—å’ŒåŠ æƒï¼š

```python
# agent_channels = [0, 1]  # åªå…³æ³¨è¿™ä¸¤ä¸ª channel
agent_loss = F.binary_cross_entropy(pred[:, agent_channels], target[:, agent_channels])
block_loss = F.binary_cross_entropy(pred[:, 4:5], target[:, 4:5])
total_loss = agent_loss * alpha + block_loss * (1 - alpha)
```

* `alpha` å»ºè®®è®¾ä¸º `0.7~0.9`ï¼Œå¼ºåŒ–å¯¹ agent çš„å…³æ³¨ï¼›
* æˆ–è€…ï¼Œå®šä¹‰ä¸€ä¸ªåƒç´ çº§åŠ æƒ maskï¼Œå¯¹ agent åŒºåŸŸä¹˜ä»¥æƒé‡ï¼ˆå¦‚ä¸‹ï¼‰ï¼š

```python
weight = torch.ones_like(target)
for c in [0, 1]:  # agenté€šé“
    weight[:, c] += 2.0  # å¢åŠ  agent åŒºåŸŸçš„lossæƒé‡
loss = F.binary_cross_entropy(pred, target, weight=weight)
```

---

### ğŸŒŸ æ–¹æ¡ˆ 2ï¼š**ä»…é¢„æµ‹å˜åŒ–éƒ¨åˆ†ï¼ˆresidualï¼‰**

åªé¢„æµ‹å˜åŒ–éƒ¨åˆ†ï¼Œå¦‚ï¼š

* `delta_state = next_state - current_state`ï¼›
* è®­ç»ƒç½‘ç»œé¢„æµ‹ `delta_state` è€Œéå®Œæ•´ `next_state`ï¼›
* é™æ€èƒŒæ™¯å’Œ block æ°¸è¿œé¢„æµ‹ä¸º `0`ï¼Œç›´æ¥ç”±è¾“å…¥æ‹·è´è¿‡å»ï¼›

æ•ˆæœï¼š

* å‡å°‘ static background å¹²æ‰°ï¼›
* æé«˜æ¨¡å‹å¯¹â€œåŠ¨ä½œå¯¼è‡´å˜åŒ–â€çš„æ•æ„Ÿåº¦ï¼›

---

### ğŸŒŸ æ–¹æ¡ˆ 3ï¼š**è¾…åŠ©ç›®æ ‡ + mask loss**

å¼•å…¥è¾…åŠ©ç›®æ ‡ï¼Œä¾‹å¦‚ï¼š

* **é¢„æµ‹ agent çš„ç›¸å¯¹ä½ç§»ï¼ˆdx, dyï¼‰**ï¼›
* **åŠ ä¸€ä¸ªåŠ¨ä½œé¢„æµ‹å¤´**ï¼›
* æˆ–è€…ç›´æ¥ï¼š

  * æ·»åŠ ä¸€ä¸ª maskï¼šé¢„æµ‹â€œå“ªé‡Œå‘ç”Ÿäº†å˜åŒ–â€ï¼ˆå˜åŒ–çƒ­å›¾ï¼‰ï¼›
  * loss ç”¨ `change_map = (next_state != current_state).float()` æ„å»ºï¼›

---

### ğŸŒŸ æ–¹æ¡ˆ 4ï¼š**æ•°æ®å¢å¼º + éšå˜é‡å»ºæ¨¡**

* å½“å‰ agent æ•°é‡å°‘ï¼ˆ2ä¸ªï¼‰ï¼Œå»ºè®®ï¼š

  * å¤šé‡‡æ · agent åˆå§‹ä½ç½®ï¼Œæ‰©å…… agent å¤šæ ·æ€§ï¼›
  * æˆ–è€…å°† agent id åŠ å…¥è¾“å…¥ï¼Œå»ºæ¨¡ä¸º one-hot featureï¼ˆposition + idï¼‰ï¼›
* å¯ä»¥è€ƒè™‘å¼•å…¥ VAE / attention æœºåˆ¶ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿè¯†åˆ«â€œè°åŠ¨äº†â€ã€‚

---

### ğŸŒŸ æ–¹æ¡ˆ 5ï¼šåªè¯„ä¼° agent åŒºåŸŸçš„é¢„æµ‹æ•ˆæœ

ä½ å¯ä»¥å•ç‹¬å¯è§†åŒ– agent çš„ channelï¼š

```python
for i in range(2):  # agent channels
    plt.imshow(pred[0, i].detach().cpu().numpy(), cmap="viridis")
```

åŒæ—¶åœ¨ eval æ—¶åŠ  metricsï¼š

* **å‡†ç¡®ç‡ï¼ˆæ˜¯å¦é¢„æµ‹åœ¨ true position å‘¨å›´ï¼‰**
* **IoUï¼ˆé¢„æµ‹ä½ç½® vs å®é™…ä½ç½®ï¼‰**
* **ä½ç½®ä¸­å¿ƒè¯¯å·®ï¼ˆpred\_max vs gt\_maxï¼‰**

---

## âœ… æ€»ç»“å»ºè®®

| é—®é¢˜                        | å»ºè®®                                     |
| ------------------------- | -------------------------------------- |
| é™æ€åŒºåŸŸå æ¯”å¤ªå¤§ï¼Œæ©ç›–äº† agent çš„ loss | å¢åŠ  agent ä¸“ç”¨ lossï¼Œæˆ– residual prediction |
| agent ç§»åŠ¨å˜åŒ–å¤ªå°ï¼Œloss ä¸æ•æ„Ÿ     | ä½¿ç”¨åŠ æƒ mask / Focal Loss / ç›¸å¯¹ä½ç§»è¾…åŠ©ç›®æ ‡      |
| æ•çŒäº‹ä»¶å¥½é¢„æµ‹ï¼Œæ™®é€šç§»åŠ¨å¾ˆéš¾å­¦           | é‡‡æ ·æ›´å¤šç§»åŠ¨çŠ¶æ€ï¼Œå¼ºåŒ–åŠ¨æ€çŠ¶æ€å­¦ä¹                       |
| agent æ•°é‡å°‘ï¼Œæ¨¡å¼æœ‰é™            | æ•°æ®å¢å¼ºæˆ–åŠ  agent ID è¾…åŠ©è¯†åˆ«                   |

---

å¦‚ä½ æœ‰ loss å¯è§†åŒ–å›¾ã€æ›´å¤šé¢„æµ‹æ ·æœ¬å›¾ï¼Œæ¬¢è¿å‘æ¥æˆ‘å¸®ä½ è¿›ä¸€æ­¥åˆ†æã€‚æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ å®ç°ä¸Šè¿°æŸä¸ªä¼˜åŒ–ä»£ç ç‰ˆæœ¬ï¼Ÿ
