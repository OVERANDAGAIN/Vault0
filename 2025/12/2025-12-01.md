
---

#  **公式 (24)–(37) 的完整逻辑链条

整段 IV-B 的逻辑本质上是：

> **在文件传输中，一切额外时间都来自两类损失：
> （1）信道误码造成 segment 损坏
> （2）链路中断造成 segment 无法送达
> 所以文件总时延 = 基本时延 + segment 重传 + CP 等待 + RS 等待 + 中断影响。**

下面从最底层开始理解。

---

#  **第一步：信道误码的本质（公式 24–26）**

我们知道 BER（bit error rate）= p
→ 每个 bit 发生错误的概率是 p。

一个 segment长度是 L bytes
→ bit 数 = 8 × L

**只要一个 bit 错，整个 segment 就算坏了**
（这是通信系统的典型假设）

所以，segment 传输成功的概率是：

$$(1-p)^{8L}$$

所以失败概率（误码概率）就是：

$$\rho = 1 - (1-p)^{8L}$$

因此有三类 segment：

| segment 类型 | 对应误码概率公式                            |
| ---------- | ----------------------------------- |
| 普通数据段 RDS  | $\rho_{Seg}=1-(1-p)^{8L_{Seg}}$ |
| RS 段       | $\rho_{RS}=1-(1-p)^{8L_{RS}}$   |
| CP 段       | $\rho_{CP}=1-(1-p)^{8L_{CP}}$   |

→ 它们分别对应公式 **(24)–(26)**。

**解释：**
更长的 segment 更容易坏，因为需要正确的 bit 更多。

---

#  **第二步：一个 segment 坏了，需要传多少次？（公式 27）**

假设一次 transmission 的成功概率是：

* 对普通数据段：$1-\rho_{Seg}$

如果 segment 在误码下的命运是：
**成功 with probability (1−ρ)**
**失败 with probability ρ**

那么为了得到一次“成功”，传输次数服从几何分布：

$$E[\text{传输次数}] = \frac{1}{1-\rho}$$

但是，这里讨论的是：

> **一个 block（含多个 segments）全部成功的期望传输次数。**

因此约化为：

$$n =
\left\lceil
\log_{\rho_{Seg}}
\left(
\frac{1}{N_{Seg}(1-\rho_{Seg})}
\right)
\right\rceil
\tag{27}$$

该公式来自之前论文 [22]，本质含义是：

* 一个 block 有 $N_{Seg}$ 个 segment
* 只要其中一个 segment 未成功 → block 需要继续尝试
* 所以 block-level 成功概率与 segment-level 成功概率有关

**一句话：**

> 公式 (27) 给出为了让一个 block 全部 segments 成功，需要的期望尝试次数 n。

---

#  **第三步：文件中到底有多少 segments？（公式 29）**

一个文件被切分成多个 LTP blocks
每个 block 又被切分成 $N_{Seg}$ 个 segments
所有 session 之间又被 bundle 聚合

因此总 segment 数为：

$$N_{Seg-total}
=

N_{block} \times N_{Seg}$$

但 block 数 = 文件大小 / bundle 大小
所以最终公式为：

$$N_{Seg-total}
=

\left\lceil \frac{L_{file}}{L_{bundle}} \right\rceil
\times
\left( \frac{N_{Seg}}{m \times N_{session}} \right)
\tag{29}$$

**这决定我们要传多少 segments。**

---

#  **第四步：传所有 segments 需要多少时间？（公式 30）**

每个 segment 的传输时间是：

$$\frac{L_{Seg}}{Rb_{data}}$$

但一个 segment 平均要传：

$$\frac{1}{1-\rho_{Seg}}$$

次才能成功。

最后乘上 segment 总数 $N_{Seg-total}$，得到：

$$T_{Seg-total}
=

\frac{L_{Seg}}{Rb_{data}}
\times
N_{Seg-total}
\times
\frac{1}{1 - \rho_{Seg}}
\tag{30}$$

**解释：**
越容易坏（ρ高） → 需要更多重传 → 时间越长。

---

#  **第五步：传播时延累计（公式 31）**

传播时延 = 往返传播时间 × block 成功尝试次数 × block 数

往返传播时延是：

$$2T_{owlt} + T_{RS}$$

成功一次 block 要 n 次 attempts，
文件共有 $N_{block}$ 个 blocks，所以：

$$T_{delay-total}
=

N_{block} \times n \times (2T_{owlt} + T_{RS})
\tag{31}$$

**解释：**
即使每次都成功，传播时延累积占很大比重（深空延迟高）。

---

#  **第六步：CP RTO 等待时间（公式 32）**

如果 CP 被误码破坏（概率 $\rho_{CP}$），
发送方必须等待一个完整的 RTO 周期才能重传。

期望传输次数为：

$$\frac{1}{1-\rho_{CP}}$$

所以浪费的等待时间为：

$$T_{CP-wait}
=

\left(
\frac{1}{1-\rho_{CP}} - 1
\right)
\times
N_{block} \times n \times T_{RTO-CP}
\tag{32}$$

**解释要点（非常关键）：**

* CP 是整个 block 的“结束标记”
* 丢了 CP → RS 不会产生 → 必须等 RTO
* 一个 CP 错误造成的代价远大于普通 segment（**这就是结论**）

---

#  **第七步：RS RTO 等待时间（公式 33）**

如果 RS 被误码破坏（概率 $\rho_{RS}$）
接收方必须等待一个 RS 的 RTO 触发重传。

同理：

$$T_{RS-wait}
=

\left(
\frac{1}{1-\rho_{RS}} - 1
\right)
\times
N_{block} \times n \times T_{RTO-RS}
\tag{33}$$

---

#  **第八步：链路中断的额外时间（公式 34）**

这一项来自前面的 Section IV-A：
$$T_{break-affect}
=

T_{break}
+
T'_{block}
\tag{34}$$

解释：

* 中断本身持续 $T_{break}$
* 中断期间丢的 segments 要在恢复后重传，耗时 $T′_{block}$

---

#  **第九步：把所有部分加起来（公式 28 → 36）**

文件传输总时间为：

$$T_{file-delivery}
=

T_{Seg-total}
+
T_{CP-wait}
+
T_{RS-wait}
+
T_{delay-total}
+
T_{break-affect}
\tag{28}$$

把前面公式 (30)–(34) 代入，就得到最终表达式：

$$T_{file-delivery} = \dots \tag{36}$$

（原文把公式展开在下一页）

**总结：**

> 文件总时延 =
> 数据段传输时间 + 等待 CP 的 RTO + 等待 RS 的 RTO + 传播时延 + 中断带来的额外重传

这就是 IV-B 的最终目的。

---

# 🔵 **第十步：Goodput（有效吞吐率）公式 (37)**

既然我们算出了文件传输时间，
有效吞吐率就很容易：

$$\gamma_{Goodput}
=

\frac{L_{file}}{T_{file-delivery}}
\tag{37}$$

**解释：**

> 文件越大、时间越短 → goodput 越高
> 错误越多、中断越严重 → goodput 越差。

---

# **完整逻辑链条一句话总结**

> **公式 (24)–(37) 的目的，是把“误码概率 + 中断次数 + 重传次数 + RTO 等待 + segment 个数 + propagation delay”全部纳入一个统一的数学框架中，用来计算文件总传输时间与 goodput。**

---

