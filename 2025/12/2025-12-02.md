---
åˆ›å»ºæ—¶é—´: 2025-åäºŒæœˆ-2æ—¥  æ˜ŸæœŸäºŒ, 9:19:20 ä¸Šåˆ
---
```text
ä¸‹é¢æˆ‘ç»™ä½ å†™ä¸€å¥— **å®Œå…¨å¯¹åº”ä½ è¿™å¼ æ¡†æ¶å›¾çš„ loss å…¬å¼**ï¼Œæ ¼å¼å¹²å‡€ã€å¯ç›´æ¥è´´åœ¨è®ºæ–‡ / PPT ä¸­ã€‚
æˆ‘ä¼šæŠŠå››ä¸ª lossï¼š
**L_{moa}ã€L_{obs}ã€L_{reward}ã€L_{cvae}ã€L_{value}**
å…¨éƒ¨ç”¨ç»Ÿä¸€ç¬¦å·å†™æ¸…æ¥šï¼Œè€Œä¸”ä¸¥æ ¼å¯¹åº”ä½ å›¾ä¸­çš„æ¨¡å—ä¸æ•°æ®æµã€‚

---

# âœ… **1. MOAï¼ˆåŠ¨ä½œé¢„æµ‹ï¼‰Lossï¼š(L_{\text{moa}})**

MOA é¢„æµ‹ä¸‹ä¸€æ­¥å…¶ä»–æ™ºèƒ½ä½“åŠ¨ä½œ (\hat{a}_t^{-i})ï¼Œç›‘ç£æ ‡ç­¾æ˜¯ç¯å¢ƒçœŸå®åŠ¨ä½œ (a_t^{-i})ã€‚

**å…¬å¼ï¼šäº¤å‰ç†µæŸå¤±ï¼ˆå¯¹æ‰€æœ‰ agentã€æ—¶é—´æ­¥æ±‚å‡å€¼ï¼‰**

[
L_{\text{moa}}
==============

\mathbb{E}*{t,i}
\big[
-\log p*{\beta}(a_t^{-i} \mid o_{t-1}, a_{t-1}^{1:N})
\big]
]

å¦‚æœä½ ç”¨ one-hotï¼š

[
L_{\text{moa}}
==============

\mathbb{E}_{t,i}
\big[
\mathrm{CE}\big(\hat{a}_t^{-i}, a_t^{-i}\big)
\big]
]

---

# âœ… **2. Observation Reconstruction Lossï¼š(L_{\text{obs}})**

ç”± World Model é¢„æµ‹ä¸‹ä¸€æ—¶åˆ»è§‚æµ‹ (\hat{o}_t)ï¼Œæ ‡ç­¾ä¸ºç¯å¢ƒä¸­ (o_t)ã€‚

[
L_{\text{obs}}
==============

\mathbb{E}*{t}
\big[
\lVert \hat{o}*{t} - o_t \rVert_2^{2}
\big]
]

å¦‚æœ‰ maskï¼Œå¯å†™ï¼š

[
L_{\text{obs}}
==============

\mathbb{E}*{t}
\big[
\lVert m_t \odot (\hat{o}*{t} - o_t) \rVert_2^{2}
\big]
]

---

# âœ… **3. Reward Prediction Lossï¼š(L_{\text{reward}})**

World Model é¢„æµ‹å¥–åŠ± (\hat{r}_t)ï¼Œç›‘ç£æ ‡ç­¾æ˜¯ç¯å¢ƒå¥–åŠ± (r_t)ã€‚

[
L_{\text{reward}}
=================

\mathbb{E}*{t}
\big[
\lVert \hat{r}*{t} - r_t \rVert_2^{2}
\big]
]

---

# âœ… **4. CVAE Lossï¼š(L_{\text{cvae}})**

CVAE åŒ…å«ä¸¤éƒ¨åˆ†ï¼š

## âœ” 4.1 é‡æ„æŸå¤±ï¼ˆReconstructionï¼‰

CVAE è¾“å…¥çš„æ˜¯å½“å‰ç‰¹å¾ (x_t)ï¼Œè¾“å‡ºé‡æ„ (\hat{x}_t)ã€‚

[
L_{\text{rec}}
==============

\mathbb{E}_{t,i}
\big[
\lVert \hat{x}_t^{,i} - x_t^{,i} \rVert_2^{2}
\big]
]

## âœ” 4.2 KL Lossï¼ˆæœ€å…³é”®ï¼å¯¹é½ Teacher VAE æˆ– Infer åˆ†å¸ƒï¼‰

ä½ çš„æ¡†æ¶å›¾é‡Œ CVAE çš„ KL æ˜¯å¯¹é½ VAE teacherï¼š

[
L_{\text{KL}}
=============

\mathbb{E}*{t,i}
\Big[
D*{\mathrm{KL}}
\big(
\mathcal{N}(\mu_{\phi}, \sigma_{\phi}^2)
;\Vert;
\mathcal{N}(\mu_{\psi}, \sigma_{\psi}^2)
\big)
\Big]
]

**å†™æˆæ˜¾å¼å…¬å¼ï¼š**

[
L_{\text{KL}}
=============

\frac{1}{2}
\mathbb{E}*{t,i}
\left[
\log\frac{\sigma^2*{\psi}}{\sigma^2_{\phi}}
+
\frac{\sigma^2_{\phi} + (\mu_{\phi}-\mu_{\psi})^2}{\sigma^2_{\psi}}
-1
\right]
]

## âœ” 4.3 æ•´ä½“ CVAE Loss

[
L_{\text{cvae}}
===============

L_{\text{rec}}
+
\alpha_{\text{cvae}} L_{\text{KL}}
]

---

# âœ… **5. Policy Value Lossï¼š(L_{\text{value}})**

è¿™ä¸ªæ¥è‡ª PPOï¼ˆå›¾ä¸­å·¦ä¸‹çš„ value å¤´ï¼‰ã€‚

PPO çš„ clipped value lossï¼š

[
L_{\text{value}}
================

\mathbb{E}*{t}
\left[
\max\left(
\left(V*{\theta}(s_t,z_t)-R_t\right)^2,
\left(V_{\theta}^{\text{clip}}(s_t,z_t)-R_t\right)^2
\right)
\right]
]

å…¶ä¸­ï¼š

[
V_{\theta}^{\text{clip}}
========================

V_{\theta}^{\text{old}}
+
\mathrm{clip}\left(
V_{\theta}-V_{\theta}^{\text{old}},
-\epsilon,\epsilon
\right)
]

---

# ğŸ”¥ **6.ï¼ˆå¯é€‰ï¼‰æ€» World Model Loss ç»„åˆï¼š**

å¦‚æœä½ éœ€è¦ä¸€ä¸ªæ€» lossï¼ˆè®­ç»ƒ world model çš„ä¸‹åŠéƒ¨åˆ†ï¼‰ï¼š

[
L_{\text{WM}}
=============

\lambda_{\text{moa}} L_{\text{moa}}
+
\lambda_{\text{obs}} L_{\text{obs}}
+
\lambda_{\text{reward}} L_{\text{reward}}
+
\lambda_{\text{cvae}} L_{\text{cvae}}
]

---

# ğŸ”¥ **7.ï¼ˆå¯é€‰ï¼‰Policy Lossï¼ˆPPOï¼‰**

å¦‚æœæƒ³åŠ åœ¨ä½ çš„å›¾é‡Œï¼Œå¯ä»¥å†™æˆï¼š

[
L_{\text{policy}}
=================

\mathbb{E}_{t}\left[
-\min\big(
r_t A_t,;
\mathrm{clip}(r_t, 1-\epsilon, 1+\epsilon)A_t
\big)
\right]

* \beta_{\text{ent}} H(\pi_\theta)

-

c_v L_{\text{value}}
]

---

# ğŸ“Œ æœ€ç»ˆå¯ç”¨äºå›¾ä¸­çš„ Loss æ ‡ç­¾

ä½ å¯ä»¥ç›´æ¥æ”¾åˆ°å›¾ä¸‹é¢ï¼š

---

## **Final Loss Definitions**

[
\boxed{
L_{\text{moa}}
=

\mathbb{E}_{t,i}
\big[
\mathrm{CE}(\hat{a}_t^{-i}, a_t^{-i})
\big]
}
]

[
\boxed{
L_{\text{obs}}= \mathbb{E}*{t}\lVert \hat{o}*{t}-o_{t} \rVert_2^2
}
]

[
\boxed{
L_{\text{reward}}= \mathbb{E}_{t}\lVert \hat{r}_{t}-r_{t} \rVert_2^2
}
]

[
\boxed{
L_{\text{cvae}}
=

\lVert\hat{x}-x\rVert_2^2
+
\alpha
D_{\mathrm{KL}}
\big(
\mathcal{N}(\mu_\phi,\sigma_\phi^2)
\Vert
\mathcal{N}(\mu_\psi,\sigma_\psi^2)
\big)
}
]

[
\boxed{
L_{\text{value}}
================

\max\big(
(V_\theta-R)^2,;
(V^{\text{clip}}_\theta-R)^2
\big)
}
]

---

# å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ æŠŠè¿™äº›å…¬å¼ç›´æ¥ **æ’æˆè®ºæ–‡æ ·å¼** æˆ– **å¾€ä½ çš„å›¾é‡Œé‡æ–°å¸ƒå±€å†™æ³¨é‡Šç‰ˆæœ¬**ï¼Œä½ åªéœ€è¦å‘Šè¯‰æˆ‘ï¼š

âœ” æƒ³æ”¾å“ªé‡Œ
âœ” å›¾é‡Œæ¯ä¸ª loss çš„é¢œè‰²/å¯¹åº”æ¨¡å—
âœ” æ˜¯å¦éœ€è¦åˆå¹¶ lossï¼ˆæ¯”å¦‚ world model çš„æ•´ä½“ lossï¼‰
æˆ‘å¯ä»¥ç›´æ¥è¾“å‡ºä¸€å¥—å¯è´´ PPT çš„æ’ç‰ˆã€‚


```