[[Logbook/公式/公式]]

# Questions

- [?] 


# Answers

## GPT_Answers
非常好的问题 👍。你卡住的点正是 **“积分”和“期望”之间的转化”**。我帮你整理一份小笔记，专门解释这个知识点，方便以后在 ELBO、变分推断里理解。

---

# 积分形式 vs 期望形式

## 1. 期望的定义

对随机变量 $X$，如果它的分布密度是 $q(z)$，那么期望定义为：

$$
\mathbb{E}_{q}[f(z)] = \int f(z) \, q(z)\, dz.
$$

👉 这就是积分形式和期望形式的桥梁：**期望就是对分布加权的积分**。

* 里面的 $f(z)$ 是“随机变量的函数”；
* 外面的 $q(z)$ 是“权重/概率密度”，保证积分的值反映了在分布下的平均。

---

## 2. 从积分变成期望

比如：

$$
\int q(z|x)\,\frac{p(x,z)}{q(z|x)}\,dz
$$

直接按照定义，可以写成：

$$
\mathbb{E}_{q(z|x)}\!\left[\frac{p(x,z)}{q(z|x)}\right].
$$

> 这里 **采样的分布** 是 $q(z|x)$，而 **被积函数** 就是 $\tfrac{p(x,z)}{q(z|x)}$。

这就是为什么 **q 在 log 外面**，它并不是 integrand 的一部分，而是定义了“从哪个分布取样、怎么算期望”。

---

## 3. 为什么要这么做？

* **积分形式**：
  $\log \int \cdots dz$ → 很难直接用不等式处理。
* **期望形式**：
  $\log \mathbb{E}_{q}[X]$ → 就能直接用 **Jensen**，因为 log 是凹函数：

  $$
  \log \mathbb{E}[X] \;\geq\; \mathbb{E}[\log X].
  $$

---

## 4. 常见场景

1. **重要性采样**

   $$
   \mathbb{E}_{p}[f(z)] = \int f(z)p(z)dz 
   = \int f(z)\frac{p(z)}{q(z)}q(z)dz 
   = \mathbb{E}_{q}\!\left[f(z)\frac{p(z)}{q(z)}\right].
   $$

2. **ELBO 推导**

   $$
   \log p(x) 
   = \log \int p(x,z)dz 
   = \log \mathbb{E}_{q(z|x)}\!\left[\tfrac{p(x,z)}{q(z|x)}\right].
   $$

---

## 5. 一句话记忆

* **积分形式**：$\int f(z) q(z) dz$
* **期望形式**：$\mathbb{E}_{q}[f(z)]$
* 其中 $q(z)$ 始终在 **log 外面**，因为它是“期望的 measure”，不是随机变量本身。

---

👉 换句话说：**积分是算总和，期望是算平均**，两者只是写法不同，本质完全等价。

---

要不要我给你画一个「小流程图」，把 **积分 → 期望 → Jensen** 的三步用图形化的方式梳理出来？


## DS_Answers


## Other_Answers


# Codes

```python

```



# FootNotes