---
created: 2025-01-15T12
updated: ...
---
[[HOP+]]


# Objectives
分析模型训练过程中耗时较长的原因

# Results

## Problem1: 分析总体时间
- [?] 

---

### 关键耗时统计

| Agent ID    | MCTS 累计耗时（秒）  | 最新一次 `compute_action()` 耗时（秒） | `compute_action()` 累计总耗时（秒）           |
| ----------- | ------------- | ----------------------------- | ------------------------------------- |
| Agent 1     | 397.9170      | 0.1188                        | 399.1039                              |
| Agent 2     | 370.8085      | 0.1198                        | 371.4923                              |
| Agent 3     | 506.2037      | 0.1526                        | 506.8729                              |
| Agent 4     | 399.3196      | 0.0370                        | 399.9435                              |
| **总计**      | **1674.2488** | –                             | **1676.4126**                         |
| **训练迭代总时间** | –             | –                             | **1679.5528** *(来自日志 `time_total_s`)* |
|             |               |                               |                                       |

🔍 说明：

1. 四个 Agent 的 compute_action 累计总耗时为 1676.41 秒

2. 与训练迭代总时间 1679.55 秒（即一次迭代全部时间）高度吻合

3. 说明：系统总时间几乎全部消耗在 action 计算过程，其中 MCTS 占比最大，且各 Agent 时间分布较均匀


---


### 详细耗时说明（以一个为例）
Agent 1 的耗时：
```
 pid=9964) [Timer] MCTS Total: 397.9170s | select: 272.7855s | expand: 121.8405s | backup: 3.2377s | final: 0.0532s 
 pid=9964) 1[Timer] Total: 0.1188s | T1: 0.0000s | T2: 0.0010s | T3: 0.1178s | Sum: 0.1188s 
 pid=9964) 1[Timer] Total Total: 399.1039s | self.timer_t1_total: 0.0110s | self.timer_t2_total: 0.9672s | self.timer_t3_total: 398.1257s 
```

| 阶段代号     | 全称                 | 功能描述                                  |
| -------- | ------------------ | ------------------------------------- |
| **T1**   | `prepare`          | 预处理阶段：提取观测、构造初始状态（如 obs 预处理、RNN 状态管理） |
| **T2**   | `subgoal planning` | 子目标预测阶段：调用子目标生成网络（如 CVAE）产生下一步的goal   |
| **T3**   | `MCTS 调用阶段`        | 执行 MCTS 搜索过程，通常为最耗时阶段，调度整个搜索逻辑        |
| `select` | 搜索树节点选择            | 遍历现有树结构找到最优节点（基于 UCB 等策略）             |
| `expand` | 节点扩展阶段             | 在选定节点后新增节点，用于扩展搜索空间                   |
| `backup` | 回传更新阶段             | 将模拟结果回传并更新树中路径的节点信息（值/访问次数等）          |
| `final`  | 最终动作决策             | 从 MCTS 搜索结果中选出最终动作（多数投票或最大值策略）        |

---

### 📊 综合分析

| 分析维度                     | 说明                                                                                       |
| ------------------------ | ---------------------------------------------------------------------------------------- |
| **MCTS 占比极高**            | 各 agent 中，`T3` 几乎占据 `compute_action` 总耗时的 99% 以上。比如 Agent 3 中，T3 为 506.48s，占比 ≈ 99.9%。   |
| **prepare、subgoal 占比极低** | 多数在 0.01–0.3s 之间，可忽略，说明状态预处理与子目标预测效率较高，不构成性能瓶颈。                                          |
| **MCTS 内部阶段中**           | `select` 与 `expand` 为主耗时部分（一般合计占比约 95%），表明优化搜索结构或减少节点扩展可能带来显著提速；`backup` 与 `final` 相对轻量。 |





## Problem2: 比较HOP+与Direct-OM
- [?] 





# Limitations
# Future Work
# FootNotes