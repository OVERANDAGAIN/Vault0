---
created: 2024-12-18T20
updated: ...
åˆ›å»ºæ—¶é—´: 2025-äºŒæœˆ-20æ—¥  æ˜ŸæœŸå››, 8:30:32 æ™šä¸Š
---
[[omg_overall]]



# Codes/Questions

- [?] 


```python
       mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])
       è¿™ä¸€æ­¥æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿå…¶ä¸­filledå’Œterminatedéƒ½æ˜¯32ï¼Œ121ï¼Œ1çš„ã€‚ 
        terminated = batch["terminated"][:, :-1].float()
        mask = batch["filled"][:, :-1].float()
        mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])
```


# Answers

## Overall_Answers
### **è§£æ `mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])`**

è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯ **è°ƒæ•´ `mask`ï¼Œç¡®ä¿åœ¨ä¸€ä¸ª episode ç»“æŸåï¼Œåç»­æ—¶é—´æ­¥çš„æ•°æ®ä¸ä¼šè¢«é”™è¯¯åœ°ä½¿ç”¨**ã€‚è¿™åœ¨å¼ºåŒ–å­¦ä¹ å’Œåºåˆ—å»ºæ¨¡ï¼ˆå¦‚ RNN æˆ– Transformerï¼‰ä¸­å¸¸è§ï¼Œä¸»è¦ç”¨äº **å±è”½æ— æ•ˆæ—¶é—´æ­¥**ï¼Œé¿å…æ¢¯åº¦ä¼ æ’­åˆ°æ— æ•ˆçš„æ•°æ®ã€‚

---

### **1. `filled` å’Œ `terminated` çš„å«ä¹‰**
- `filled`ï¼ˆ`batch["filled"]`ï¼‰:
  - å½¢çŠ¶ï¼š`(32, 121, 1)`  
  - ä½œç”¨ï¼šè¡¨ç¤ºè¯¥æ—¶é—´æ­¥æ˜¯å¦æœ‰æ•ˆï¼ˆä¾‹å¦‚ï¼Œæ˜¯å¦å¡«å……äº†çœŸå®æ•°æ®ï¼Œæˆ–è€…æ˜¯å¡«å……çš„ `padding`ï¼‰ã€‚
  - å–å€¼ï¼š
    - `1`ï¼šè¡¨ç¤ºè¿™ä¸ªæ—¶é—´æ­¥çš„æ•°æ®æ˜¯æœ‰æ•ˆçš„ã€‚
    - `0`ï¼šè¡¨ç¤ºè¿™ä¸ªæ—¶é—´æ­¥çš„æ•°æ®æ˜¯ `padding`ï¼ˆæ— æ•ˆï¼‰ã€‚

- `terminated`ï¼ˆ`batch["terminated"]`ï¼‰:
  - å½¢çŠ¶ï¼š`(32, 121, 1)`  
  - ä½œç”¨ï¼šè¡¨ç¤ºå½“å‰æ—¶é—´æ­¥ `t` æ˜¯å¦æ˜¯ episode çš„ç»ˆæ­¢æ—¶é—´æ­¥ã€‚
  - å–å€¼ï¼š
    - `1`ï¼šè¡¨ç¤ºè¯¥æ—¶é—´æ­¥æ˜¯ **episode ç»“æŸç‚¹**ï¼ˆå³ `done=True`ï¼‰ã€‚
    - `0`ï¼šè¡¨ç¤ºè¯¥æ—¶é—´æ­¥ **ä¸æ˜¯** ç»ˆæ­¢ç‚¹ï¼Œepisode è¿˜åœ¨ç»§ç»­ã€‚

---

### **2. é€æ­¥è§£æä»£ç **
```python
terminated = batch["terminated"][:, :-1].float()
mask = batch["filled"][:, :-1].float()
mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])
```
**æ¯ä¸€æ­¥çš„ä½œç”¨ï¼š**

1ï¸âƒ£ **ç¬¬ä¸€è¡Œ**
```python
terminated = batch["terminated"][:, :-1].float()
```
- `batch["terminated"]` å½¢çŠ¶æ˜¯ `(32, 121, 1)`ã€‚
- `[:, :-1]` ä½œç”¨ï¼šå»æ‰æœ€åä¸€ä¸ªæ—¶é—´æ­¥ï¼Œä½¿å¾— `terminated` å½¢çŠ¶å˜æˆ `(32, 120, 1)`ã€‚
- **è¡¨ç¤ºå‰ 120 ä¸ªæ—¶é—´æ­¥çš„ç»ˆæ­¢çŠ¶æ€**ï¼Œ`1` ä»£è¡¨è¯¥æ—¶é—´æ­¥æ˜¯ episode ç»“æŸï¼Œ`0` ä»£è¡¨ episode ä»åœ¨ç»§ç»­ã€‚

---

2ï¸âƒ£ **ç¬¬äºŒè¡Œ**
```python
mask = batch["filled"][:, :-1].float()
```
- `batch["filled"]` å½¢çŠ¶æ˜¯ `(32, 121, 1)`ã€‚
- `[:, :-1]` ä½œç”¨ï¼šå»æ‰æœ€åä¸€ä¸ªæ—¶é—´æ­¥ï¼Œä½¿å¾— `mask` å½¢çŠ¶å˜æˆ `(32, 120, 1)`ã€‚
- **`mask` è®°å½•å“ªäº›æ—¶é—´æ­¥çš„æ•°æ®æ˜¯æœ‰æ•ˆçš„**ï¼ˆç”¨äºæ¢¯åº¦è®¡ç®—ç­‰ï¼‰ã€‚

---

3ï¸âƒ£ **å…³é”®æ­¥éª¤**
```python
mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])
```
- **`mask[:, 1:]` ä½œç”¨**
  - `[:, 1:]`ï¼šä»ç¬¬äºŒä¸ªæ—¶é—´æ­¥ï¼ˆ`t=1`ï¼‰å¼€å§‹ï¼Œå¯¹ `mask` è¿›è¡Œä¿®æ”¹ï¼Œ**è·³è¿‡ `t=0`**ï¼ˆå› ä¸º `t=0` æ²¡æœ‰å‰ä¸€ä¸ªæ—¶é—´æ­¥ï¼‰ã€‚
  - å½¢çŠ¶ï¼š`(32, 119, 1)`ï¼ˆå› ä¸º `mask[:, 1:]` å»æ‰äº†ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥ï¼‰ã€‚
  
- **`terminated[:, :-1]` ä½œç”¨**
  - `terminated[:, :-1]`ï¼šè¡¨ç¤ºå‰ä¸€ä¸ªæ—¶é—´æ­¥ `t-1` æ˜¯å¦æ˜¯ episode ç»“æŸç‚¹ï¼ˆ`1` ä»£è¡¨ episode ç»“æŸï¼Œ`0` ä»£è¡¨æœªç»“æŸï¼‰ã€‚
  - å½¢çŠ¶ï¼š`(32, 119, 1)`ï¼Œä¸ `mask[:, 1:]` å½¢çŠ¶åŒ¹é…ã€‚

- **è®¡ç®— `mask[:, 1:] * (1 - terminated[:, :-1])`**
  - å¦‚æœå‰ä¸€ä¸ªæ—¶é—´æ­¥ `t-1` ç»“æŸäº†ï¼ˆ`terminated[:, :-1] == 1`ï¼‰ï¼š
    - `1 - 1 = 0`ï¼Œ`mask[:, 1:]` å˜æˆ `0`ï¼Œ**å±è”½æ‰ `t` æ—¶é—´æ­¥çš„æ•°æ®**ã€‚
  - å¦‚æœå‰ä¸€ä¸ªæ—¶é—´æ­¥ `t-1` æ²¡æœ‰ç»“æŸï¼ˆ`terminated[:, :-1] == 0`ï¼‰ï¼š
    - `1 - 0 = 1`ï¼Œ`mask[:, 1:]` **ä¿æŒä¸å˜**ã€‚

---

### **3. ä½œç”¨æ€»ç»“**
è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ï¼š
1. **ç¡®ä¿ episode ç»“æŸåï¼Œæ‰€æœ‰åç»­æ—¶é—´æ­¥çš„ `mask` è®¾ä¸º `0`ï¼Œé˜²æ­¢å®ƒä»¬å½±å“æ¨¡å‹è®­ç»ƒ**ã€‚
2. **é¿å…æ¢¯åº¦ä¼ æ’­åˆ°æ— æ•ˆæ—¶é—´æ­¥**ï¼Œç¡®ä¿åªåœ¨æœ‰æ•ˆæ—¶é—´æ­¥è¿›è¡Œè®¡ç®—ã€‚
3. **é˜²æ­¢å¤šä¸ª episode ä¹‹é—´çš„æ•°æ®æ··åˆ**ï¼Œç¡®ä¿æ¢¯åº¦ä¸ä¼šè·¨è¶Š episode ç•Œé™ã€‚

---

### **4. ç¤ºä¾‹**
å‡è®¾ `batch["filled"]` å’Œ `batch["terminated"]` çš„æ•°æ®å¦‚ä¸‹ï¼š

| æ—¶é—´æ­¥ (`t`)  | `filled` (æœ‰æ•ˆæ•°æ®) | `terminated` (æ˜¯å¦ episode ç»“æŸ) |
|--------------|----------------|----------------------|
| 0            | 1              | 0                    |
| 1            | 1              | 0                    |
| 2            | 1              | 0                    |
| 3            | 1              | **1** (episode ç»“æŸ)  |
| 4            | 1              | 0                    |
| 5            | 1              | 0                    |
| 6            | 1              | 0                    |

#### **ç¬¬ä¸€æ­¥ï¼š`mask = filled[:, :-1]`**
```
mask = [1, 1, 1, 1, 1, 1]  # (å»æ‰äº†æœ€åä¸€ä¸ªæ—¶é—´æ­¥)
```

#### **ç¬¬äºŒæ­¥ï¼š`mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])`**
- `terminated[:, :-1] = [0, 0, 0, 1, 0, 0]`
- `1 - terminated[:, :-1] = [1, 1, 1, 0, 1, 1]`
- `mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])`

è®¡ç®—ç»“æœï¼š
```
mask = [1, 1, 1, 1, 0, 1]  # `t=4` ä¹‹åçš„ `mask` å˜ä¸º `0`
```
å³ `t=4` åŠä»¥åçš„æ—¶é—´æ­¥ **æ— æ•ˆåŒ–**ï¼Œä¸ä¼šå‚ä¸è®¡ç®—ã€‚

---

### **5. æ€»ç»“**
âœ… **å¤„ç† episode ç»“æŸåçš„æ•°æ®**
- `mask[:, 1:] = mask[:, 1:] * (1 - terminated[:, :-1])`
- è®© `mask` åœ¨ episode ç»“æŸåï¼ˆ`terminated==1`ï¼‰å°†åç»­æ—¶é—´æ­¥çš„å€¼è®¾ä¸º `0`ï¼Œé˜²æ­¢æ•°æ®è¢«é”™è¯¯ä½¿ç”¨ã€‚

âœ… **ç¡®ä¿æ¢¯åº¦ä¸ä¼šè·¨ episode**
- ç¡®ä¿æ¯ä¸ª episode å†…éƒ¨çš„æ•°æ®æ˜¯ç‹¬ç«‹çš„ï¼Œé˜²æ­¢é”™è¯¯ä¼ æ’­ã€‚

âœ… **å…¸å‹ç”¨é€”**
- ç”¨äºå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰ã€RNN è®­ç»ƒã€åºåˆ—å»ºæ¨¡æ—¶çš„ **masking** æœºåˆ¶ï¼Œé¿å…å¯¹æ— æ•ˆæ•°æ®è¿›è¡Œæ¢¯åº¦è®¡ç®—ã€‚

ğŸš€ **è¿™æ ·å¯ä»¥ä¿è¯æ¢¯åº¦åªåœ¨æœ‰æ•ˆæ—¶é—´æ­¥ä¼ æ’­ï¼Œä¸ä¼šå½±å“åˆ° padding æ—¶é—´æ­¥æˆ–è€…æ— æ•ˆæ•°æ®ï¼** ğŸš€

## 1_Answers


## 2_Answers


## 3_Answers




# FootNotes
